<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #FF4D4D;
        }
    </style>

    
    
    
    
    
    

    
    <title>GitOpså®è·µï¼ŒåŸºäºGitlab CIã€Kustomize ä¸Argo CD</title>
    <meta name="description" content="keep curious ğŸ˜¼">
    <meta name="keywords" content='blog, chinalhr, lhr, gitops, ci-cd, argo cd, kubernetes'>

    <meta property="og:url" content="https://chinalhr.github.io/post/gitops-argo-cd/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="GitOpså®è·µï¼ŒåŸºäºGitlab CIã€Kustomize ä¸Argo CD">
    <meta property="og:description" content="keep curious ğŸ˜¼">
    <meta property="og:image" content="https://user-images.githubusercontent.com/19829495/188320707-5b468cc9-bea4-486c-b591-57ff8324e41c.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="GitOpså®è·µï¼ŒåŸºäºGitlab CIã€Kustomize ä¸Argo CD">
    <meta name="twitter:description" content="keep curious ğŸ˜¼">
    <meta property="twitter:domain" content="https://chinalhr.github.io/post/gitops-argo-cd/">
    <meta property="twitter:url" content="https://chinalhr.github.io/post/gitops-argo-cd/">
    <meta name="twitter:image" content="https://user-images.githubusercontent.com/19829495/188320707-5b468cc9-bea4-486c-b591-57ff8324e41c.jpg">

    
    <link rel="canonical" href="https://chinalhr.github.io/post/gitops-argo-cd/" />

    <link rel="stylesheet" type="text/css" href="https://chinalhr.github.io//css/normalize.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" type="text/css" href="https://chinalhr.github.io//css/main.css">
    <link disabled id="dark-theme" rel="stylesheet" href="https://chinalhr.github.io//css/dark.css">

    <script src="https://chinalhr.github.io//js/svg-injector.min.js"></script>
    <script src="https://chinalhr.github.io//js/feather-icons.min.js"></script>
    <script src="https://chinalhr.github.io//js/main.js"></script>

    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JLJBQBW5WM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){window.dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JLJBQBW5WM');
</script>
  
    
    
    

    
    <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css">
</head>
<body>
        <script type="text/javascript">
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        
        <div class="avatar">
            <a href="https://chinalhr.github.io/">
                <img src="https://user-images.githubusercontent.com/19829495/188320707-5b468cc9-bea4-486c-b591-57ff8324e41c.jpg" alt="avatar" />
            </a>
        </div>
        

        <div class="nav-title">
            <a class="nav-brand" href="https://chinalhr.github.io/">LHR</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="https://chinalhr.github.io/" aria-label="Jump to a specific link"><span data-feather='home'></span> Home </a>
            </div>
            
            <div class="nav-link">
                <a href="https://chinalhr.github.io/post/" aria-label="Jump to a specific link"><span data-feather='book'></span> Posts </a>
            </div>
            
            <div class="nav-link">
                <a href="https://chinalhr.github.io/tags/" aria-label="Jump to a specific link"><span data-feather='tag'></span> Tags </a>
            </div>
            
            <div class="nav-link">
                <a href="https://chinalhr.github.io/projects/" aria-label="Jump to a specific link"><span data-feather='code'></span> Projects </a>
            </div>
            
            <div class="nav-link">
                <a href="https://chinalhr.github.io/about/" aria-label="Jump to a specific link"><span data-feather='user'></span> About </a>
            </div>
            
            <div class="nav-link">
                <a href="https://github.com/chinalhr" aria-label="Jump to a specific link"><span data-feather='github'></span>  </a>
            </div>
            
            <div class="nav-link">
                <a href="https://chinalhr.github.io/index.xml" aria-label="Jump to a specific link"><span data-feather='rss'></span>  </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span id="dark-theme-toggle-screen-reader-target" class="sr-only"></span>
                <a>
                    <span id="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span id="hamburger-menu-toggle-screen-reader-target" class="sr-only">menu</span>
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="https://chinalhr.github.io/" aria-label="Jump to a specific link"><span data-feather='home'></span> Home </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://chinalhr.github.io/post/" aria-label="Jump to a specific link"><span data-feather='book'></span> Posts </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://chinalhr.github.io/tags/" aria-label="Jump to a specific link"><span data-feather='tag'></span> Tags </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://chinalhr.github.io/projects/" aria-label="Jump to a specific link"><span data-feather='code'></span> Projects </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://chinalhr.github.io/about/" aria-label="Jump to a specific link"><span data-feather='user'></span> About </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://github.com/chinalhr" aria-label="Jump to a specific link"><span data-feather='github'></span>  </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://chinalhr.github.io/index.xml" aria-label="Jump to a specific link"><span data-feather='rss'></span>  </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span id="dark-theme-toggle-screen-reader-target" class="sr-only">theme</span>
                    <a>
                        <span id="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>GitOpså®è·µï¼ŒåŸºäºGitlab CIã€Kustomize ä¸Argo CD</h1>
        <small role="doc-subtitle"></small>
        <p class="post-date">
            July 20, 2022
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="https://chinalhr.github.io/tags/gitops">gitops</a></li>
        
            <li class="post-tag"><a href="https://chinalhr.github.io/tags/ci-cd">ci-cd</a></li>
        
            <li class="post-tag"><a href="https://chinalhr.github.io/tags/argo-cd">argo cd</a></li>
        
            <li class="post-tag"><a href="https://chinalhr.github.io/tags/kubernetes">kubernetes</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <p>
            <blockquote>
<p>GitOpsæ€»ç»“ä¸å®è·µ</p>
</blockquote>
<h2 id="gitops">GitOps</h2>
<h3 id="ä»€ä¹ˆæ˜¯gitops">ä»€ä¹ˆæ˜¯GitOps</h3>
<p>GitOpsæ˜¯Weaveworkså…¬å¸äº2017å¹´é¦–åˆ›çš„ä¸€ç§è¿›è¡ŒKubernetesé›†ç¾¤ç®¡ç†å’Œåº”ç”¨äº¤ä»˜çš„æ–¹å¼ã€‚GitOpsé€šè¿‡ä½¿ç”¨Gitä½œä¸ºå£°æ˜æ€§åŸºç¡€è®¾æ–½å’Œåº”ç”¨ç¨‹åºçš„å•ä¸€äº‹å®æ¥æºè¿›è¡Œå·¥ä½œã€‚
GitOpsçš„æ ¸å¿ƒæ˜¯å°†åº”ç”¨çš„å£°æ˜æ€§åŸºç¡€æ¶æ„æè¿°ã€åº”ç”¨æºç ä¸è‡ªåŠ¨åŒ–æµç¨‹å­˜æ”¾åœ¨Git Repositoryä¸­ï¼Œå°†Gitä½œä¸ºäº¤ä»˜æµæ°´çº¿çš„æ ¸å¿ƒã€‚GitOpsä¼šDiff Repositoryä¸­å£°æ˜ä¿¡æ¯ä¸Kubernetesé›†ç¾¤ä¸­å®é™…è¿è¡Œçš„å†…å®¹ä¹‹é—´çš„å·®å¼‚ï¼Œå…¶å®ç°çš„GitOps Kubernetes Operatorä¼šæ ¹æ®æƒ…å†µè¿›è¡Œè‡ªåŠ¨æ›´æ–°æˆ–å›æ»šé›†ç¾¤ï¼›é€šè¿‡å°†Gitä½œä¸ºäº¤ä»˜æµæ°´çº¿çš„æ ¸å¿ƒï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨pushã€pull requestç­‰Gitæ“ä½œï¼Œä»¥åŠ é€Ÿå’Œç®€åŒ–Kubernetesé›†ç¾¤åº”ç”¨ç¨‹åºçš„éƒ¨ç½²å’Œæ“ä½œä»»åŠ¡ã€‚</p>
<p><strong>GitOpsæ˜¯ç”¨äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨ç¨‹åºçš„æ“ä½œæ¨¡å‹</strong></p>
<ol>
<li>GitOpsä¸ºKubernetesæˆ–å…¶ä»–äº‘åŸç”ŸæŠ€æœ¯çš„æ“ä½œæ¨¡å‹ï¼Œæä¾›äº†ä¸€ç»„æœ€ä½³å®è·µï¼Œç»Ÿä¸€å®¹å™¨åŒ–é›†ç¾¤å’Œåº”ç”¨ç¨‹åºåŸºäºGitéƒ¨ç½²ã€ç®¡ç†å’Œç›‘æ§ã€‚</li>
<li>ä¼˜åŒ–å¼€å‘äººå‘˜ç®¡ç†åº”ç”¨ç¨‹åºçš„æ–¹å¼ï¼ŒåŒ…æ‹¬åº”ç”¨ CI/CD pipeline å’Œ Git Flow çš„æ“ä½œå’Œå¼€å‘ã€‚</li>
</ol>
<h3 id="ä½¿ç”¨gitopsçš„å‰ç½®æ¡ä»¶">ä½¿ç”¨GitOpsçš„å‰ç½®æ¡ä»¶</h3>
<ul>
<li>å£°æ˜å¼æè¿°æ•´ä¸ªåº”ç”¨ç³»ç»Ÿï¼Œå¹¶ä½¿ç”¨Gitè¿›è¡Œç‰ˆæœ¬åŒ–æ§åˆ¶</li>
</ul>
<p>ä»»ä½•èƒ½å¤Ÿè¢«æè¿°çš„å†…å®¹éƒ½å¿…é¡»å­˜å‚¨äºGitä»“åº“ä¸­ï¼Œå¦‚Kubernetesèµ„æºå¯¹è±¡æè¿°ï¼›å£°æ˜æ€§æ„å‘³ç€é…ç½®ç”±ä¸€ç»„äº‹å®è€Œä¸æ˜¯ä¸€ç»„æŒ‡ä»¤æ¥ä¿è¯ï¼ŒåŸºäºGitå¯¹åº”ç”¨ç¨‹åºçš„å£°æ˜ã€‚æè¿°è¿›è¡Œç‰ˆæœ¬æ§åˆ¶åï¼Œå°±æœ‰äº†å•ä¸€çš„äº‹å®æ¥æºï¼Œåº”ç”¨ç¨‹åºå¯ä»¥è½»æ¾éƒ¨ç½²åˆ°Kubernetesï¼Œå¹¶è¿›è¡Œå‡çº§ã€å›æ»šï¼Œè€Œä¸”å½“å®¹ç¾å¤„ç†æ—¶ä¹Ÿå¯ä»¥å¿«é€Ÿã€å¯é åœ°å¤åˆ¶åŸºç¡€è®¾æ–½ã€‚</p>
<ul>
<li>Git Approved Changesåè‡ªåŠ¨æ›´æ–°</li>
</ul>
<p>å…è®¸å¯¹å£°æ˜ä¿¡æ¯çš„å˜æ›´ï¼Œè‡ªåŠ¨åŒ–æ›´æ–°äºé›†ç¾¤ä¸­ï¼Œå¹¶ä¸”ä¸éœ€è¦é›†ç¾¤å‡­è¯æ¥æ›´æ”¹ç³»ç»Ÿï¼Œåœ¨éš”ç¦»çš„ç¯å¢ƒä¸­ä½¿ç”¨GitOpsï¼Œå°†çŠ¶æ€å®šä¹‰ä½äºå¤–éƒ¨ï¼Œä½¿å¾—å¯ä»¥å°†&quot;æ‰€åšçš„äº‹æƒ…&quot;å’Œ&quot;å°†è¦å¦‚ä½•åšçš„äº‹æƒ…&quot;åˆ†å¼€ã€‚</p>
<ul>
<li>é€šè¿‡GitOpsç¡®ä¿æ­£ç¡®æ€§ä»¥åŠåˆ†æ­§æŠ¥è­¦</li>
</ul>
<p>ä¸€æ—¦ç³»ç»ŸçŠ¶æ€è¢«å£°æ˜å¹¶å—ç‰ˆæœ¬æ§åˆ¶ï¼Œå¯ä»¥é€šè¿‡GitOpsæä¾›çš„å·¥å…·å¯¹çœŸå®çš„ç³»ç»ŸçŠ¶æ€ä¸ç‰ˆæœ¬æ§åˆ¶ä¸­å£°æ˜çš„ç³»ç»ŸçŠ¶æ€è¿›è¡ŒDiffï¼Œåœ¨çœŸå®çš„ç³»ç»ŸçŠ¶æ€ä¸ç‰ˆæœ¬æ§åˆ¶ä¸­å£°æ˜çš„ç³»ç»ŸçŠ¶æ€ä¸ä¸€è‡´æ—¶è¿›è¡Œé€šçŸ¥ï¼›ä»¥åŠé€šè¿‡GitOpså·¥å…·æ”¯æŒç³»ç»Ÿåœ¨æ•…éšœã€äººä¸ºé”™è¯¯æ—¶è¿›è¡Œè‡ªæˆ‘ä¿®å¤ã€‚</p>
<h3 id="ä¸å¯å˜åŸºç¡€è®¾æ–½iacä¸gitops">ä¸å¯å˜åŸºç¡€è®¾æ–½ã€IaCä¸GitOps</h3>
<blockquote>
<p>ä¸å¯å˜åŸºç¡€è®¾æ–½ï¼ˆImmutable Infrastructureï¼‰ï¼šä¸å¯å˜åŸºç¡€è®¾æ–½æ˜¯ç”±Chad Fowleräº 2013 å¹´æå‡ºçš„ä¸€ä¸ªæ„æƒ³ï¼šåœ¨è¿™ç§æ¨¡å¼ä¸­ä»»ä½•åŸºç¡€è®¾æ–½çš„å®ä¾‹ä¸€æ—¦åˆ›å»ºä¹‹åä¾¿æˆä¸ºä¸€ç§åªè¯»çŠ¶æ€ï¼Œä¸å¯å¯¹å…¶è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚å¦‚æœéœ€è¦ä¿®æ”¹æˆ–å‡çº§æŸäº›å®ä¾‹ï¼Œå”¯ä¸€çš„æ–¹å¼å°±æ˜¯åˆ›å»ºä¸€æ‰¹æ–°çš„å®ä¾‹ä»¥æ›¿æ¢ã€‚
ä¼ ç»Ÿå¯å˜åŸºç¡€è®¾æ–½æ˜¯å°†åº”ç”¨æ‰“åŒ…å¥½éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œéœ€è¦ç¡®ä¿ç¯å¢ƒçš„ç»Ÿä¸€ï¼Œå¹¶é€šè¿‡ä¿®æ”¹ã€è¡¥ä¸çš„æ–¹å¼æŒç»­æ›´æ–°åº”ç”¨ï¼Œéšç€æ—¶é—´çš„æ¨ç§»å¾ˆéš¾å†ç¡®ä¿æ‰€æœ‰çš„æœºå™¨å¤„äºç›¸åŒçš„çŠ¶æ€ï¼›è€Œä¸å¯å˜åŸºç¡€æ¶æ„ï¼Œæ˜¯å°†æ•´ä¸ªæœºå™¨ç¯å¢ƒæ‰“åŒ…æˆä¸€ä¸ªå•ä¸€çš„ä¸å¯å˜å•å…ƒï¼Œè¿™ä¸ªå•å…ƒåŒ…å«äº†æ•´ä¸ªç¯å¢ƒå’Œåº”ç”¨æœ¬èº«ï¼Œä»¥è§£å†³ä¼ ç»Ÿå¯å˜åŸºç¡€æ¶æ„çš„é—®é¢˜ã€‚</p>
</blockquote>
<blockquote>
<p>åŸºç¡€æ¶æ„å³ä»£ç ï¼ˆIaCï¼‰æ˜¯é€šè¿‡ä»£ç ï¼ˆè€Œéæ‰‹åŠ¨æµç¨‹ï¼‰æ¥ç®¡ç†å’Œç½®å¤‡åŸºç¡€æ¶æ„çš„æ–¹æ³•ã€‚</p>
</blockquote>
<p>é€šè¿‡ä½¿ç”¨å®¹å™¨æŠ€æœ¯å¯ä»¥å®ç°åŸºç¡€è®¾æ–½çš„ä¸å˜æ€§ï¼Œè€ŒKubernetesçš„å£°æ˜æ€§å®¹å™¨ç¼–æ’å¯ä»¥å®ç°åŸºç¡€æ¶æ„å³ä»£ç ã€‚GitOpsåŸºäºä¸å¯å˜åŸºç¡€è®¾æ–½å’ŒIaCï¼Œç»“åˆGitè¿›è¡Œåº”ç”¨ç³»ç»Ÿæ•´ä¸ªé…ç½®æ–‡ä»¶é›†ç‰ˆæœ¬æ§åˆ¶ã€‚</p>
<h3 id="gitopsçš„å·¥ä½œæ¨¡å¼">GitOpsçš„å·¥ä½œæ¨¡å¼</h3>
<ul>
<li>Gitå¯¹ç¯å¢ƒé…ç½®è¿›è¡Œç‰ˆæœ¬æ§åˆ¶</li>
</ul>
<p>GitOpsä»¥Gitä¸ºæ ¸å¿ƒè¿›è¡Œå·¥ä½œï¼Œé™¤äº†åº”ç”¨ç¨‹åºçš„ä»“åº“å¤–ï¼Œè¿˜éœ€è¦å¯¹ç¯å¢ƒé…ç½®çš„ä»“åº“è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼›å…¶ä¸­åº”ç”¨ç¨‹åºä»“åº“å«åº”ç”¨ç¨‹åºçš„æºç ä¸éƒ¨ç½²ç›¸å…³çš„manifestsï¼Œç¯å¢ƒé…ç½®ä»“åº“åŒ…å«åº”ç”¨æ‰€éœ€åŸºç¡€æ¶æ„ä¸éƒ¨ç½²ç›¸å…³çš„manifestsã€‚</p>
<ul>
<li>GitOpsåŸºäºpullçš„å·¥ä½œæ¨¡å¼</li>
</ul>
<p>
<div class="post-img-view">
    <a data-fancybox="gallery" data-src="/_attachment/e6d64cf38f3719fe721213756e0ef8ab_MD5.png">
    <img src="/_attachment/e6d64cf38f3719fe721213756e0ef8ab_MD5.png" alt="image"  />
    </a>
</div></p>
<p>GitOpså¤§éƒ½åŸºäºPullæ¨¡å¼å»å·¥ä½œï¼Œå¼€å‘äººå‘˜æ¨é€åº”ç”¨ä»£ç åˆ°åº”ç”¨ä»“åº“åï¼Œç»è¿‡Pull Requeståˆå¹¶åˆ°ç›®æ ‡åˆ†æ”¯åï¼Œè§¦å‘CI Pipelineï¼Œæ„å»ºæ¨é€åº”ç”¨å®¹å™¨é•œåƒä¸æ¨é€æ›´æ–°ç¯å¢ƒé…ç½®ä»“åº“ï¼›åœ¨CDé˜¶æ®µï¼Œé€šè¿‡å¼•å…¥Operatorï¼Œä¸æ–­è§‚å¯Ÿç¯å¢ƒé…ç½®åº“çš„å£°æ˜ä¿¡æ¯å¹¶ä¸å½“å‰é›†ç¾¤çš„åº”ç”¨ç¯å¢ƒè¿›è¡ŒDiffï¼Œå½“å­˜åœ¨å·®å¼‚æ—¶è¿›è¡Œé›†ç¾¤åº”ç”¨ç¯å¢ƒçš„éƒ¨ç½²ã€æ›´æ–°æˆ–è€…è¿˜åŸã€‚</p>
<ul>
<li>GitOpsåŸºäºpushçš„å·¥ä½œæ¨¡å¼</li>
</ul>
<p>
<div class="post-img-view">
    <a data-fancybox="gallery" data-src="/_attachment/ecbd3fe62c464544e22c09db1c68ce49_MD5.png">
    <img src="/_attachment/ecbd3fe62c464544e22c09db1c68ce49_MD5.png" alt="image"  />
    </a>
</div></p>
<p>GitOpsä¹Ÿå¯ä»¥åŸºäºPushæ¨¡å¼å»å·¥ä½œï¼Œå¯¹æ¯”åŸºäºPullçš„å·¥ä½œæ¨¡å¼ï¼ŒPushæ¨¡å¼åœ¨CI Pipelineå®Œæˆé˜¶æ®µä¼šå»é€šçŸ¥Operatorè¿›è¡Œç¯å¢ƒé…ç½®ä¿¡æ¯çš„æ‹‰å–ä¸éƒ¨ç½²ã€æ›´æ–°ã€‚Pushæ¨¡å¼æœ‰ç€ä¼ ç»ŸCI/CDæµç¨‹çš„ç›´è§‚æ€§ï¼Œå¯¹æ¯”Pullæ¨¡å¼æœ‰ç€æ›´å¥½çš„å®æ—¶æ€§ä¸æ€§èƒ½ï¼Œä½†å´ç¼ºå°‘äº†å¯¹
ç«¯ï¼ˆç¯å¢ƒé…ç½®ä¿¡æ¯ï¼‰åˆ°ç«¯ï¼ˆé›†ç¾¤åº”ç”¨ä¿¡æ¯ï¼‰ä¸€è‡´æ€§çš„ä¿è¯ã€‚</p>
<h3 id="gitopsçš„ä¼˜åŠ¿">GitOpsçš„ä¼˜åŠ¿</h3>
<p>é€šè¿‡GitOpsï¼Œå½“æˆ‘ä»¬å¯¹Git Repositoryè¿›è¡Œæ›´æ”¹æ—¶ï¼ŒGitOpsçš„è‡ªåŠ¨åŒ–äº¤ä»˜æµæ°´çº¿ä¼šè‡ªåŠ¨å°†å˜æ›´éƒ¨ç½²åˆ°åŸºç¡€æ¶æ„ä¸­ã€‚è€Œä¸”ï¼ŒGitOpsè¿˜ä¼šä½¿ç”¨å·¥å…·å°†åº”ç”¨ç¨‹åºçš„å®é™…çŠ¶æ€ä¸Git Repositoryä¸­çš„å£°æ˜çŠ¶æ€è¿›è¡Œæ¯”è¾ƒï¼Œä»¥é€šçŸ¥é›†ç¾¤Git Repositoryä¸­å£°æ˜çŠ¶æ€ä¸å®é™…ç¯å¢ƒçš„Diffã€‚</p>
<p>é€šè¿‡åº”ç”¨GitOpsï¼ŒåŸºç¡€è®¾æ–½å’Œåº”ç”¨ç¨‹åºä»£ç éƒ½æœ‰ä¸€ä¸ªâ€œçœŸå®æ¥æºâ€ï¼Œæé«˜äº†å¼€å‘å›¢é˜Ÿé€Ÿåº¦å¹¶æé«˜ç³»ç»Ÿå¯é æ€§ã€‚</p>
<p>å°†GitOpsç†è®ºåº”ç”¨åœ¨æŒç»­äº¤ä»˜æµæ°´çº¿ä¸Šæœ‰ç€æ·±è¿œçš„å¥½å¤„ï¼š</p>
<ul>
<li>æé«˜ç”Ÿäº§åŠ›ï¼šå…·æœ‰é›†æˆåé¦ˆæ§åˆ¶å›è·¯çš„è‡ªåŠ¨åŒ–æŒç»­éƒ¨ç½²å¯ä»¥æ˜¾è‘—åŠ å¿«éƒ¨ç½²æ—¶é—´ã€‚</li>
<li>å¢åŠ å¼€å‘ä½“éªŒï¼šå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼ˆGitï¼‰æ›´å¿«é€Ÿã€æ–¹ä¾¿åœ°ç®¡ç†Kubernetesçš„æ›´æ–°å’ŒåŠŸèƒ½ã€‚</li>
<li>æ›´åŠ ç¨³å®šä¸å¯é ï¼šå¯ä»¥ä½¿ç”¨Git Flowæ¥ç®¡ç†é›†ç¾¤åº”ç”¨ï¼Œè€Œä¸”å¯ä»¥æ–¹ä¾¿åœ°è·å¾—å®¡è®¡æ—¥å¿—ï¼Œè®°å½•é›†ç¾¤åº”ç”¨çš„æ›´æ”¹ï¼›å€ŸåŠ©Gitçš„revert/rollbackï¼Œå¯ä»¥ç¨³å®šä¸”å¯é‡ç°åœ°è¿›è¡Œå›æ»šã€æ¢å¤æ“ä½œã€‚</li>
<li>ä¸€è‡´æ€§å’Œæ ‡å‡†åŒ–ï¼šGitOpsæä¾›äº†æ ‡å‡†åŒ–çš„æ¨¡å‹ä»¥è¿›è¡ŒåŸºç¡€è®¾æ–½ã€åº”ç”¨ç¨‹åºä¸Kubernetesçš„é™„åŠ æ›´æ”¹ï¼Œå¯ä»¥ä¿æŒç»„ç»‡ä¸­ç«¯åˆ°ç«¯å·¥ä½œæµçš„å·²æ‰§è¡ŒçŠ¶æ€ã€‚</li>
</ul>
<h2 id="argo-cd">Argo CD</h2>
<p>Argo CDæ˜¯ä¸€ä¸ªç”¨äºKubernetesçš„å£°æ˜å¼GitOpsæŒç»­äº¤ä»˜å·¥å…·ï¼›Argo CDéµå¾ªGitOpsæ¨¡å¼ï¼Œä½¿ç”¨Gitå­˜å‚¨åº“ä½œä¸ºå®šä¹‰æ‰€éœ€åº”ç”¨ç¨‹åºçŠ¶æ€çš„çœŸå®æ¥æº, Argo CDæ”¯æŒå¤šç§Kubernetes manifests å¦‚kustomizeã€helm chartsã€jsonnet files&hellip;ã€‚Argo CDå¯ä»¥åœ¨æŒ‡å®šçš„ç›®æ ‡ç¯å¢ƒä¸­è‡ªåŠ¨éƒ¨ç½²æ‰€éœ€çš„åº”ç”¨ç¨‹åºçŠ¶æ€ï¼Œåº”ç”¨ç¨‹åºéƒ¨ç½²å¯ä»¥è·Ÿè¸ªåˆ†æ”¯ã€æ ‡ç­¾çš„æ›´æ–°æˆ–åœ¨Gitæäº¤æ—¶å›ºå®šåˆ°ç‰¹å®šç‰ˆæœ¬çš„æ¸…å•ã€‚</p>
<h3 id="argo-cdç‰¹æ€§">Argo CDç‰¹æ€§</h3>
<ul>
<li>å°†åº”ç”¨ç¨‹åºè‡ªåŠ¨éƒ¨ç½²åˆ°æŒ‡å®šçš„ç›®æ ‡ç¯å¢ƒ</li>
<li>æ”¯æŒå¤šç§é…ç½®ç®¡ç†/æ¨¡æ¿å·¥å…·ï¼ˆKustomizeã€Helmã€Jsonnetã€plain-YAMLï¼‰</li>
<li>æ”¯æŒç®¡ç†å’Œéƒ¨ç½²åˆ°å¤šä¸ªé›†ç¾¤</li>
<li>SSO é›†æˆï¼ˆOIDCã€OAuth2ã€LDAPã€SAML 2.0ã€GitHubã€GitLabã€Microsoftã€LinkedInï¼‰</li>
<li>ç”¨äºæˆæƒçš„å¤šç§Ÿæˆ·å’Œ RBAC ç­–ç•¥</li>
<li>åŸºäºGitç‰ˆæœ¬æ§åˆ¶ï¼Œæ”¯æŒå›æ»šåˆ°Gitå­˜å‚¨åº“ä¸­æäº¤çš„ä»»ä½•åº”ç”¨ç¨‹åºçŠ¶æ€</li>
<li>æŒç»­ç›‘æ§ä¸åˆ†æåº”ç”¨èµ„æºçš„å¥åº·çŠ¶å†µ</li>
<li>æ”¯æŒè‡ªåŠ¨æˆ–æ‰‹åŠ¨ï¼ˆåŸºäºPull/Pushæ¨¡å¼ï¼‰è§¦å‘åº”ç”¨ç¨‹åºåŒæ­¥åˆ°æ‰€éœ€çŠ¶æ€</li>
<li>æä¾›å¯è§†åŒ–çš„Web UIä¸ç”¨äºè‡ªåŠ¨åŒ–ä¸CIé›†æˆçš„CLI</li>
<li>Webhook é›†æˆï¼ˆGitHubã€BitBucketã€GitLabï¼‰ï¼Œä»¥åŠæä¾›ç”¨äºè‡ªåŠ¨åŒ–çš„è®¿é—®ä»¤ç‰Œ</li>
<li>PreSyncã€Syncã€PostSync hooks ä»¥æ”¯æŒå¤æ‚çš„åº”ç”¨ç¨‹åºçš„éƒ¨ç½²ç­–ç•¥ï¼ˆå¦‚blue/green ã€canary upgradesï¼‰</li>
<li>åº”ç”¨ç¨‹åºäº‹ä»¶å’ŒAPIè°ƒç”¨çš„å®¡è®¡è·Ÿè¸ª</li>
<li>PrometheusæŒ‡æ ‡</li>
</ul>
<h3 id="argo-cdæ¶æ„">Argo CDæ¶æ„</h3>
<p>Argo CD é€šè¿‡kubernetesæ§åˆ¶å™¨å®ç°ï¼Œé€šè¿‡æŒç»­ç›‘æ§é›†ç¾¤ä¸­æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºå¹¶å°†å½“å‰çš„çŠ¶æ€ä¿¡æ¯ä¸æ‰€éœ€çš„ç›®æ ‡çŠ¶æ€ï¼ˆç¯å¢ƒé…ç½®ä»“åº“ï¼‰è¿›è¡Œæ¯”è¾ƒã€‚é€šè¿‡Diffå®æ—¶çŠ¶æ€ä¸ç›®æ ‡çŠ¶æ€ï¼Œå¦‚æœå­˜åœ¨å·®å¼‚åˆ™åº”ç”¨è¿›å…¥OutOfSyncçŠ¶æ€ï¼›Argo CDä¼šæŠ¥å‘Šå’Œå¯è§†åŒ–å·®å¼‚ï¼ŒåŒæ—¶æä¾›å·¥å…·è‡ªåŠ¨æˆ–æ‰‹åŠ¨çš„æ–¹å¼å°†å®æ—¶çŠ¶æ€åŒæ­¥å›æ‰€éœ€ç›®æ ‡çŠ¶æ€ã€‚åœ¨ Git å­˜å‚¨åº“ä¸­å¯¹æ‰€éœ€ç›®æ ‡çŠ¶æ€æ‰€åšçš„ä»»ä½•ä¿®æ”¹éƒ½å¯ä»¥è‡ªåŠ¨åº”ç”¨å¹¶åæ˜ åœ¨æŒ‡å®šçš„ç›®æ ‡ç¯å¢ƒä¸­ã€‚</p>
<p>Argo CDä¸»è¦ç”±API Serverã€Repository Serverã€Application Controllerç»„æˆã€‚</p>
<p>
<div class="post-img-view">
    <a data-fancybox="gallery" data-src="/_attachment/ca36ce5482f3f8404a128029472763a4_MD5.png">
    <img src="/_attachment/ca36ce5482f3f8404a128029472763a4_MD5.png" alt="image"  />
    </a>
</div></p>
<p><strong>API Server</strong>
Argo CDçš„ API Serveræ˜¯ä¸€ä¸ªgRPC/RESTæœåŠ¡ï¼Œå®ƒå…¬å¼€äº†Argo CDçš„Web UIã€CLI API ä¸CI/CDç³»ç»Ÿä½¿ç”¨çš„APIï¼Œä¸»è¦èŒè´£ä¸ºï¼š</p>
<ul>
<li>åº”ç”¨ç¨‹åºç®¡ç†å’ŒçŠ¶æ€æŠ¥å‘Š</li>
<li>è°ƒç”¨åº”ç”¨ç¨‹åºè¿›è¡Œç›¸å…³çš„æ“ä½œï¼Œå¦‚åŒæ­¥ã€å›æ»šã€è‡ªå®šä¹‰æ“ä½œç­‰</li>
<li>å­˜å‚¨åº“å’Œé›†ç¾¤å‡­è¯ç®¡ç†(ä½¿ç”¨K8s secretsè¿›è¡Œå­˜å‚¨)</li>
<li>å¯¹å¤–éƒ¨èº«ä»½æä¾›è€…çš„èº«ä»½éªŒè¯å’Œæˆæƒ</li>
<li>åŸºäºRBACçš„è§’è‰²è®¿é—®æƒé™æ§åˆ¶</li>
<li>Git Webhook äº‹ä»¶çš„listener/forwarder</li>
</ul>
<p><strong>Repository Server</strong>
å­˜å‚¨åº“æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå†…éƒ¨æœåŠ¡ï¼Œç»´æŠ¤ä¿å­˜åº”ç”¨ç¨‹åºGitå­˜å‚¨åº“çš„æœ¬åœ°ç¼“å­˜ï¼Œå½“åº”ç”¨è®¾ç½®å¦‚ä¸‹è¾“å…¥ä¿¡æ¯æ—¶ï¼Œå®ƒè´Ÿè´£ç”Ÿæˆå’Œè¿”å› Kubernetes manifestsï¼š</p>
<ul>
<li>å­˜å‚¨åº“URL</li>
<li>git revisionï¼ˆcommit, tag, branchï¼‰</li>
<li>åº”ç”¨ç¨‹åºè®¾ç½®çš„è·¯å¾„</li>
<li>æ¨¡æ¿é…ç½®ï¼šparametersã€helm values.yaml</li>
</ul>
<p><strong>Application Controller</strong>
åº”ç”¨ç¨‹åºæ§åˆ¶å™¨æ˜¯ä¸€ä¸ªKubernetes Controllerï¼Œå®ƒæŒç»­ç›‘æ§æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºå¹¶å°†å½“å‰çš„çŠ¶æ€ä¿¡æ¯ä¸æ‰€éœ€çš„ç›®æ ‡çŠ¶æ€ï¼ˆç¯å¢ƒé…ç½®ä»“åº“ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œå¯¹æ£€æµ‹åˆ°çš„OutOfSyncçŠ¶æ€çš„åº”ç”¨ç¨‹åºé€‰æ‹©å¯¹åº”çš„çº æ­£æªæ–½è¿›è¡Œçº æ­£ã€‚å®ƒè¿˜è´Ÿè´£è°ƒç”¨ä»»ä½•ç”¨æˆ·å®šä¹‰çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼ˆPreSyncã€Syncã€PostSyncï¼‰å¯¹åº”çš„hooksã€‚</p>
<h3 id="argo-cdéƒ¨ç½²">Argo CDéƒ¨ç½²</h3>
<p>Argo CDæ”¯æŒä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼šå¤šç§Ÿæˆ·ï¼ˆmulti-tenantï¼‰ã€æ ¸å¿ƒï¼ˆcoreï¼‰ã€‚</p>
<ul>
<li>
<p>å¤šç§Ÿæˆ·ï¼ˆmulti-tenantï¼‰
å¤šç§Ÿæˆ·æ¨¡å¼æ˜¯å®‰è£…Argo CDæœ€å¸¸è§çš„æ–¹å¼ï¼Œé€šå¸¸ç”¨äºä¸ºå…¬å¸å†…å¤šä¸ªå¼€å‘å›¢é˜Ÿæä¾›æœåŠ¡ï¼Œå¹¶ç”±å¹³å°å›¢é˜Ÿè¿›è¡Œç»´æŠ¤ï¼›ç”¨æˆ·å¯ä»¥ä½¿ç”¨Web UIæˆ–CLI é€šè¿‡ API Serverè®¿é—® Argo CDï¼›æ”¯æŒHAä¸éHAæ–¹å¼è¿›è¡Œéƒ¨ç½²ã€‚</p>
</li>
<li>
<p>æ ¸å¿ƒï¼ˆcoreï¼‰
æ ¸å¿ƒæ¨¡å¼é€‚åˆç‹¬ç«‹ä½¿ç”¨Argo CDä¸”ä¸éœ€è¦å¤šç§Ÿæˆ·ç‰¹æ€§çš„é›†ç¾¤ç®¡ç†å‘˜ï¼›æ ¸æ˜¾æ¨¡å¼åŒ…å«æ›´å°‘çš„ç»„ä»¶å¹¶ä¸”æ›´æ˜“äºè®¾ç½®ï¼Œbundleä¸åŒ…å«API Serveræˆ–Web UIï¼Œå¹¶åªå®‰è£…æ¯ä¸ªç»„ä»¶çš„è½»é‡çº§ï¼ˆé HAï¼‰ç‰ˆæœ¬ï¼›ç”¨æˆ·éœ€è¦ Kubernetes è®¿é—®æƒé™æ¥ç®¡ç† Argo CDã€‚</p>
</li>
</ul>
<p>å…·ä½“çš„éƒ¨ç½²æ–¹å¼å¯ä»¥å‚è€ƒï¼š<a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/installation/">https://argo-cd.readthedocs.io/en/stable/operator-manual/installation/</a></p>
<h2 id="ä½¿ç”¨kustomizeå®šåˆ¶ç®¡ç†kubernetesèµ„æº">ä½¿ç”¨Kustomizeå®šåˆ¶/ç®¡ç†Kubernetesèµ„æº</h2>
<h3 id="å…³äºkustomize">å…³äºKustomize</h3>
<p>Kustomizeæ˜¯ä¸€ä¸ªé€šè¿‡kustomizationæ–‡ä»¶å®šåˆ¶Kuberneteså¯¹è±¡çš„å·¥å…·ï¼›kustomizeå…è®¸æ‚¨è‡ªå®šä¹‰åŸå§‹çš„ã€æ— æ¨¡æ¿çš„Kubernetes YAMLæ–‡ä»¶ä»¥ç”¨äºå¤šç§ç”¨é€”ï¼Œè€ŒåŸå§‹Kubernetes YAMLä¿æŒä¸å˜ä¸”å¯æŒ‰åŸæ ·ä½¿ç”¨ã€‚</p>
<p>Kustomizeå¯ä»¥è§£æå¹¶ä¿®è¡¥Kubernetes APIå¯¹è±¡ï¼Œå¦‚åŒ<code>make</code>åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­è¿›è¡Œå£°æ˜ï¼Œå¦‚åŒ<code>sed</code>å¯ä»¥å‘å‡ºè§£æå¹¶ä¿®è¡¥å®Œæˆçš„YAMLæ–‡æœ¬ã€‚</p>
<p>å¯ä»¥é€šè¿‡kustomize buildå‘½ä»¤ç”Ÿæˆè‡ªå®šä¹‰YAMLï¼Œä»1.14ç‰ˆæœ¬å¼€å§‹kubectlä¹Ÿæ”¯æŒä½¿ç”¨kustomizationæ–‡ä»¶æ¥ç®¡ç†Kuberneteså¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡kubectl kustomizeå‘½ä»¤ç”Ÿæˆè‡ªå®šä¹‰YAMLã€‚</p>
<h3 id="ä½¿ç”¨kustomizeå®šåˆ¶ç®¡ç†kubernetesèµ„æº-1">ä½¿ç”¨Kustomizeå®šåˆ¶/ç®¡ç†Kubernetesèµ„æº</h3>
<p>kustomizeæä¾›ä»¥ä¸‹åŠŸèƒ½ç‰¹æ€§å®šåˆ¶/ç®¡ç†Kubernetesåº”ç”¨é…ç½®æ–‡ä»¶</p>
<p>
<div class="post-img-view">
    <a data-fancybox="gallery" data-src="/_attachment/f37330337605e7e1f846b3d8797dcf50_MD5.png">
    <img src="/_attachment/f37330337605e7e1f846b3d8797dcf50_MD5.png" alt="image"  />
    </a>
</div></p>
<ul>
<li>ä»å…¶ä»–æ¥æºç”Ÿæˆèµ„æº</li>
</ul>
<p>Kustomizeæä¾›<code>secretGenerator</code>å’Œ<code>configMapGenerator</code>ï¼Œå¯ä»¥åŸºäºæ–‡ä»¶æˆ–å­—é¢å€¼æ¥ç”ŸæˆSecretå’ŒConfigMapã€‚å¦‚ä¸‹ï¼Œä».envæ–‡ä»¶ç”ŸæˆConfigMapã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">apiVersion</span>: kustomize.config.k8s.io/v1beta1
<span style="color:#66d9ef">kind</span>: Kustomization
<span style="color:#66d9ef">resources</span>:
- deployment.yaml
- service.yaml
<span style="color:#66d9ef">configMapGenerator</span>:
- <span style="color:#66d9ef">envs</span>:
  - .env
  <span style="color:#66d9ef">name</span>: echo-config
</code></pre></div><ul>
<li>ä¸ºèµ„æºè®¾ç½®è´¯ç©¿æ€§ï¼ˆCross-Cuttingï¼‰å­—æ®µ
å¦‚åŒæ¨¡æ¿ä¸­çš„å˜é‡ï¼Œä¸ºåœ¨é¡¹ç›®ä¸­æ‰€æœ‰çš„Kuberneteså¯¹è±¡è®¾ç½®è´¯ç©¿æ€§å­—æ®µï¼Œå¦‚ä¸ºæ‰€æœ‰èµ„æºè®¾ç½®ç›¸åŒçš„åå­—ç©ºé—´ï¼›ä¸ºæ‰€æœ‰å¯¹è±¡æ·»åŠ ç›¸åŒçš„å‰ç¼€åç¼€ã€æ ‡ç­¾ã€æ³¨è§£ç­‰ã€‚</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">apiVersion</span>: kustomize.config.k8s.io/v1beta1
<span style="color:#66d9ef">kind</span>: Kustomization
<span style="color:#66d9ef">resources</span>:
- deployment.yaml
- service.yaml
<span style="color:#66d9ef">namespace</span>: dev
<span style="color:#66d9ef">namePrefix</span>: dev-
<span style="color:#66d9ef">nameSuffix</span>: <span style="color:#e6db74">&#34;-test&#34;</span>
<span style="color:#66d9ef">commonLabels</span>:
  <span style="color:#66d9ef">app</span>: echo
<span style="color:#66d9ef">commonAnnotations</span>:
  <span style="color:#66d9ef">sidecar</span>: monitoring
<span style="color:#66d9ef">resources</span>:
- deployment.yaml
- service.yaml
</code></pre></div><ul>
<li>ç»„ç»‡å’Œå®šåˆ¶èµ„æºé›†åˆ
åœ¨é¡¹ç›®ä¸­æ„é€ èµ„æºé›†åˆå¹¶å°†å…¶æ”¾åˆ°åŒä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ä¸­ç®¡ç†ã€‚Kustomizeæä¾›åŸºäºä¸åŒæ–‡ä»¶æ¥ç»„ç»‡èµ„æºå¹¶å‘å…¶åº”ç”¨è¡¥ä¸æˆ–è€…å…¶ä»–å®šåˆ¶çš„èƒ½åŠ›ã€‚</li>
</ul>
<p>kustomization.yamlæ–‡ä»¶çš„<code>resources</code>å­—æ®µå®šä¹‰é…ç½®ä¸­è¦åŒ…å«çš„èµ„æºåˆ—è¡¨ï¼Œè¾¾åˆ°èµ„æºçš„ç»„ç»‡ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">apiVersion</span>: kustomize.config.k8s.io/v1beta1
<span style="color:#66d9ef">kind</span>: Kustomization
<span style="color:#66d9ef">resources</span>:
- deployment.yaml
- service.yaml
</code></pre></div><p>è¡¥ä¸æ–‡ä»¶ï¼ˆPatchesï¼‰å¯ä»¥ç”¨æ¥å¯¹èµ„æºæ‰§è¡Œä¸åŒçš„å®šåˆ¶ã€‚Kustomizeé€šè¿‡<code>patchesStrategicMerge</code>å’Œ<code>patchesJson6902</code>æ”¯æŒä¸åŒçš„æ‰“è¡¥ä¸æœºåˆ¶ã€‚
<code>patchesStrategicMerge</code>çš„å†…å®¹æ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„çš„åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªæ–‡ä»¶éƒ½åº”å¯è§£æä¸ºç­–ç•¥æ€§åˆå¹¶è¡¥ä¸ï¼ˆStrategic Merge Patchï¼‰ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#75715e"># deployment replace patch file </span>
<span style="color:#66d9ef">apiVersion</span>: apps/v1
<span style="color:#66d9ef">kind</span>: Deployment
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: echo
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">replicas</span>: <span style="color:#ae81ff">3</span>

<span style="color:#75715e"># deployment memory patch file</span>
<span style="color:#66d9ef">apiVersion</span>: apps/v1
<span style="color:#66d9ef">kind</span>: Deployment
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: echo
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">template</span>:
    <span style="color:#66d9ef">spec</span>:
      <span style="color:#66d9ef">containers</span>:
      - <span style="color:#66d9ef">name</span>: echo
        <span style="color:#66d9ef">resources</span>:
          <span style="color:#66d9ef">limits</span>:
            <span style="color:#66d9ef">memory</span>: 512Mi

<span style="color:#75715e"># kustomization file</span>
<span style="color:#66d9ef">apiVersion</span>: kustomize.config.k8s.io/v1beta1
<span style="color:#66d9ef">kind</span>: Kustomization
<span style="color:#66d9ef">resources</span>:
- deployment.yaml
- service.yaml
<span style="color:#66d9ef">patchesStrategicMerge</span>:
- deployment_replicas_patch.yaml
- deployment_memory_patch.yaml
</code></pre></div><p>ä¹Ÿå¯ä»¥é€šè¿‡<code>patchesJson6902</code>æ¥ä½¿ç”¨JSONè¡¥ä¸çš„èƒ½åŠ›ï¼Œå¯¹æ¯”<code>patchesStrategicMerge</code>çš„åˆå¹¶æœºåˆ¶ï¼Œ<code>patchesJson6902</code>æ”¯æŒå¯¹ä»»ä½•èµ„æºçš„ä»»ä½•å­—æ®µè¿›è¡Œä¿®æ”¹ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#75715e"># deployment replace patch file </span>
- <span style="color:#66d9ef">op</span>: replace
  <span style="color:#66d9ef">path</span>: /spec/replicas
  <span style="color:#66d9ef">value</span>: <span style="color:#ae81ff">3</span>

<span style="color:#75715e"># kustomization file</span>
<span style="color:#66d9ef">apiVersion</span>: kustomize.config.k8s.io/v1beta1
<span style="color:#66d9ef">kind</span>: Kustomization
<span style="color:#66d9ef">resources</span>:
- deployment.yaml
- service.yaml
<span style="color:#66d9ef">patchesJson6902</span>:
- <span style="color:#66d9ef">target</span>:
    <span style="color:#66d9ef">group</span>: apps
    <span style="color:#66d9ef">version</span>: v1
    <span style="color:#66d9ef">kind</span>: Deployment
    <span style="color:#66d9ef">name</span>: echo
  <span style="color:#66d9ef">path</span>: deployment_replicas_patch.yaml
</code></pre></div><p>kustomizeä¹Ÿæä¾›äº†å¯¹è±¡å­—æ®µå€¼æ³¨å…¥çš„åŠŸèƒ½ï¼Œä¾‹å¦‚é€šè¿‡imageså­—æ®µè®¾ç½®æ–°çš„é•œåƒã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">apiVersion</span>: kustomize.config.k8s.io/v1beta1
<span style="color:#66d9ef">kind</span>: Kustomization
<span style="color:#66d9ef">resources</span>:
- deployment.yaml
- service.yaml
<span style="color:#66d9ef">images</span>:
- <span style="color:#66d9ef">name</span>: echo
  <span style="color:#66d9ef">newName</span>: my.image.registry/echo
  <span style="color:#66d9ef">newTag</span>: <span style="color:#ae81ff">1.1.0</span>
</code></pre></div><h3 id="åŸºå‡†basesä¸è¦†ç›–overlays">åŸºå‡†ï¼ˆBasesï¼‰ä¸è¦†ç›–ï¼ˆOverlaysï¼‰</h3>
<p>Kustomizeä¸­æœ‰åŸºå‡†ï¼ˆbasesï¼‰å’Œè¦†ç›–ï¼ˆoverlaysï¼‰çš„æ¦‚å¿µï¼ŒåŸºå‡†æ˜¯åŒ…å«kustomization.yamlæ–‡ä»¶çš„æœ¬åœ°ç›®å½•æˆ–è€…è¿œç¨‹ä»“åº“ç›®å½•ï¼ŒåŒ…å«ä¸€ç»„èµ„æºåŠå…¶ç›¸å…³çš„å®šåˆ¶ï¼›è¦†ç›–ä¹Ÿæ˜¯ä¸€ä¸ªç›®å½•ï¼Œå…¶ä¸­åŒ…å«å°†å…¶ä»–kustomizationç›®å½•å½“åšbasesæ¥å¼•ç”¨çš„kustomization.yamlæ–‡ä»¶ã€‚
åŸºå‡†ä¸è¦†ç›–æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œè¦†ç›–å¯ä»¥å¼•ç”¨å¤šä¸ªåŸºå‡†ï¼ŒåŸºå‡†ä¹Ÿå¯ä»¥è¢«å¤šä¸ªè¦†ç›–å¼•ç”¨ï¼Œæé«˜äº†kustomizeçš„é«˜åº¦å®šåˆ¶æ€§ã€‚</p>
<p>
<div class="post-img-view">
    <a data-fancybox="gallery" data-src="/_attachment/bfa93e9949e28c9dd8ffd38385b78fdf_MD5.png">
    <img src="/_attachment/bfa93e9949e28c9dd8ffd38385b78fdf_MD5.png" alt="image"  />
    </a>
</div></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">â”œâ”€â”€ base
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â””â”€â”€ service.yaml
â””â”€â”€ overlays
    â”œâ”€â”€ development
    â”‚   â”œâ”€â”€ cpu_count.yaml
    â”‚   â”œâ”€â”€ kustomization.yaml
    â”‚   â””â”€â”€ replica_count.yaml
    â””â”€â”€ production
        â”œâ”€â”€ cpu_count.yaml
        â”œâ”€â”€ kustomization.yaml
        â””â”€â”€ replica_count.yaml
</code></pre></div><p>kustomizeçš„è¯¦ç»†ç”¨æ³•å¯ä»¥å‚è€ƒï¼š</p>
<ul>
<li><a href="https://kubectl.docs.kubernetes.io/guides/introduction/kustomize/">https://kubectl.docs.kubernetes.io/guides/introduction/kustomize/</a></li>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/manage-kubernetes-objects/kustomization/">https://kubernetes.io/zh-cn/docs/tasks/manage-kubernetes-objects/kustomization/</a></li>
</ul>
<h3 id="kustomize-vs-helm">Kustomize Vs Helm</h3>
<p>Kustomizeå¯¹æ¯”Helmï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹è¡¨æ ¼æ¥å¯¹æ¯”ä¸¤è€…çš„ç‰¹æ€§ï¼š</p>
<table>
<thead>
<tr>
<th>ç‰¹å¾</th>
<th>Helm</th>
<th>Kustomize</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ¨¡æ¿æ”¯æŒ</td>
<td>âˆš</td>
<td>Ã—</td>
</tr>
<tr>
<td>è¦†ç›–æ”¯æŒ</td>
<td>Ã—</td>
<td>âˆš</td>
</tr>
<tr>
<td>æ‰“åŒ…æ”¯æŒ</td>
<td>âˆš</td>
<td>Ã—</td>
</tr>
<tr>
<td>éªŒè¯hooks</td>
<td>âˆš</td>
<td>Ã—</td>
</tr>
<tr>
<td>å›æ»šæ”¯æŒ</td>
<td>âˆš</td>
<td>Ã—</td>
</tr>
<tr>
<td>åŸç”Ÿ K8s é›†æˆ</td>
<td>Ã—</td>
<td>âˆš</td>
</tr>
<tr>
<td>å£°æ˜æ€§</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>å¯è§æ€§å’Œé€æ˜åº¦</td>
<td>å¼±</td>
<td>å¼º</td>
</tr>
</tbody>
</table>
<p>å¯¹æ¯”ä¸¤è€…ï¼Œæ¯”è¾ƒæ˜¾è‘—çš„å·®åˆ«æ˜¯Helmçš„æµç¨‹ä¸»è¦åŸºäºæ¨¡æ¿ï¼Œç±»ä¼¼äºç€‘å¸ƒå¼çš„ [æ¨¡æ¿å®šä¹‰-&gt;æ¨¡æ¿å¡«å……-&gt;ç”Ÿæˆèµ„æºæ–‡ä»¶]ï¼›Kustomizeçš„æµç¨‹åŸºäºè¦†ç›–ï¼Œç±»ä¼¼äºè¿­ä»£å¼çš„Baseå’ŒOverlayç‹¬ç«‹è¿­ä»£å˜æ›´ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œé€‰æ‹©ä½¿ç”¨æ›´å¥‘åˆGitOps ç‰ˆæœ¬åŒ–æ§åˆ¶æ€æƒ³çš„Kustomizeè¿›è¡Œå®è·µã€‚</p>
<h2 id="åŸºäºgitlab-cikustomize-argo-cdçš„gitopså®è·µ">åŸºäºGitlab CIã€Kustomizeã€ Argo CDçš„GitOpså®è·µ</h2>
<h3 id="å‰ç½®æ¡ä»¶">å‰ç½®æ¡ä»¶</h3>
<ul>
<li>Dockerï¼šä½¿ç”¨é•œåƒæ„å»ºï¼Œæ‰“åŒ…å®ç°åŸºç¡€è®¾æ–½çš„ä¸å˜æ€§ï¼›å®ç°å¯¹ä¸å¯å˜åŸºç¡€è®¾æ–½ï¼ˆImmutable Infrastructureï¼‰çš„æ”¯æŒã€‚</li>
<li>Kubernetesï¼šå£°æ˜æ€§å®¹å™¨ç¼–æ’ï¼Œå®ç°åŸºç¡€æ¶æ„å³ä»£ç ï¼ˆIaCï¼‰çš„æ”¯æŒã€‚</li>
<li>Gitlabï¼šMerge Requestä¸Approval ä½œä¸ºæ‰€æœ‰åŸºç¡€æ¶æ„æ›´æ–°çš„æ›´æ”¹æœºåˆ¶ï¼ˆMRsï¼‰ï¼ŒGit Repositoryå®ç°å¯¹æºç ç‰ˆæœ¬æ§åˆ¶æ”¯æŒï¼Œ- - Gitlab CIä½œä¸ºå¯¹GitOps CIé˜¶æ®µçš„æ”¯æŒã€‚</li>
<li>Kustomizeï¼šå¯¹Kubernetesèµ„æºå¯¹è±¡çš„å®šåˆ¶ã€‚</li>
<li>Argo CDï¼šå£°æ˜å¼GitOps CDæ”¯æŒã€‚</li>
</ul>
<h3 id="gitopsæµç¨‹">GitOpsæµç¨‹</h3>
<p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©åŸºäºpullçš„å·¥ä½œæ¨¡å¼å»å®ç°GitOpsï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>
<div class="post-img-view">
    <a data-fancybox="gallery" data-src="/_attachment/a0bc74573a4d33903d86e5bddd51db7e_MD5.png">
    <img src="/_attachment/a0bc74573a4d33903d86e5bddd51db7e_MD5.png" alt="image"  />
    </a>
</div></p>
<h3 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">â”œâ”€â”€ .backup
â”‚   â”œâ”€â”€ ci-base
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â””â”€â”€ Makefile
â”‚   â””â”€â”€ gitlab
â”‚       â””â”€â”€ note.md
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .gitlab-ci.yml
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ .kubernetes
â”‚   â”œâ”€â”€ base
â”‚   â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”‚   â””â”€â”€ service.yaml
â”‚   â””â”€â”€ overlays
â”‚       â”œâ”€â”€ production
â”‚       â”‚   â”œâ”€â”€ deployment_patch.yaml
â”‚       â”‚   â”œâ”€â”€ .env
â”‚       â”‚   â””â”€â”€ kustomization.yaml
â”‚       â””â”€â”€ staging
â”‚           â”œâ”€â”€ deployment_patch.yaml
â”‚           â”œâ”€â”€ .env
â”‚           â””â”€â”€ kustomization.yaml
â”œâ”€â”€ main.go
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬ä¸ºäº†æ›´ç®€å•ç›´è§‚çš„å±•ç¤ºæµç¨‹ï¼Œå°†åº”ç”¨ä»“åº“ä¸ç¯å¢ƒé…ç½®ä»“åº“åˆå¹¶ä¸ºä¸€ä¸ªï¼Œä½¿ç”¨Golangã€Ginç®€å•å®ç°äº†ä¸€ä¸ªåº”ç”¨æœåŠ¡ï¼›å…¶ä¸­<code>.backup</code>ç›®å½•ä¸ºåŸºç¡€CIé•œåƒçš„manifestsï¼Œ<code>.kubernetesm</code>ç›®å½•æ˜¯åŸºäºKustomizeçš„manifestsã€‚</p>
<h3 id="gitopsæµç¨‹å®è·µ">GitOpsæµç¨‹å®è·µ</h3>
<h4 id="åº”ç”¨dockeré•œåƒæ„å»º">åº”ç”¨Dockeré•œåƒæ„å»º</h4>
<p>ä½¿ç”¨makefileå®šä¹‰äº†ä¸‰ä¸ªphony target ï¼Œé…åˆDockerfileå®ç°Dockeré•œåƒæ„å»ºã€é•œåƒè¿œç¨‹ä»“åº“ç™»å½•ä¸ä¸Šä¼ é•œåƒ</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile"><span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> build-release-image
<span style="color:#a6e22e">build-release-image</span><span style="color:#f92672">:</span>
	docker build . <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>		--no-cache <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>		--force-rm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>		-t <span style="color:#66d9ef">$(</span>release-image<span style="color:#66d9ef">)</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>		-f Dockerfile

<span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> login-docker-registry
<span style="color:#a6e22e">login-docker-registry</span><span style="color:#f92672">:</span>
	docker login -u <span style="color:#66d9ef">$(</span>registry-user<span style="color:#66d9ef">)</span> -p <span style="color:#66d9ef">$(</span>registry-password<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>registry-host<span style="color:#66d9ef">)</span>

<span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> push-release-image
<span style="color:#a6e22e">push-release-image</span><span style="color:#f92672">:</span>
	docker push <span style="color:#66d9ef">$(</span>release-image<span style="color:#66d9ef">)</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> golang:1.18 as build</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> GO111MODULE<span style="color:#f92672">=</span>on
<span style="color:#66d9ef">ENV</span> GOPROXY<span style="color:#f92672">=</span>https://goproxy.cn,direct<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /go/release</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ADD</span> . .<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> GOOS<span style="color:#f92672">=</span>linux CGO_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> GOARCH<span style="color:#f92672">=</span>amd64 go build -ldflags<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-s -w&#34;</span> -installsuffix cgo -o app main.go<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> scratch as prod</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --from<span style="color:#f92672">=</span>build /usr/share/zoneinfo/Asia/Shanghai /etc/localtime<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --from<span style="color:#f92672">=</span>build /go/release/app /<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;/app&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><h4 id="kustomizeå®šåˆ¶å£°æ˜å¼kubernetesèµ„æºå¯¹è±¡">Kustomizeå®šåˆ¶å£°æ˜å¼Kubernetesèµ„æºå¯¹è±¡</h4>
<p>è¿™é‡Œä½¿ç”¨Kustomize Base/Overlayæ¥ç®¡ç†Kuberneteså¤šç¯å¢ƒèµ„æºé…ç½®ä¸ä½¿ç”¨Patchesç‰¹æ€§æ¥è¿›è¡Œè¿­ä»£æ›´æ–°;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">â”‚   â”œâ”€â”€ base
â”‚   â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”‚   â””â”€â”€ service.yaml
â”‚   â””â”€â”€ overlays
â”‚       â”œâ”€â”€ production
â”‚       â”‚   â”œâ”€â”€ deployment_patch.yaml
â”‚       â”‚   â”œâ”€â”€ .env
â”‚       â”‚   â””â”€â”€ kustomization.yaml
â”‚       â””â”€â”€ staging
â”‚           â”œâ”€â”€ deployment_patch.yaml
â”‚           â”œâ”€â”€ .env
â”‚           â””â”€â”€ kustomization.yaml
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#75715e"># base kustomization.yaml å®šåˆ¶åº”ç”¨çš„åŸºç¡€kubernetesèµ„æº</span>
<span style="color:#66d9ef">apiVersion</span>: kustomize.config.k8s.io/v1beta1
<span style="color:#66d9ef">kind</span>: Kustomization
<span style="color:#66d9ef">commonLabels</span>:
  <span style="color:#66d9ef">app</span>: saken
<span style="color:#66d9ef">namespace</span>: default
<span style="color:#66d9ef">resources</span>:
- deployment.yaml
- service.yaml
<span style="color:#75715e"># overlay kustomization.yaml å®šåˆ¶åº”ç”¨ä¸åŒç¯å¢ƒï¼ˆstaging/production/...ï¼‰ç‰¹å®škubernetesèµ„æºå±æ€§ï¼Œ</span>
<span style="color:#75715e"># åŸºäºconfigMapGeneratorä»ä¸åŒç¯å¢ƒçš„envæ–‡ä»¶ç”Ÿæˆä¸åŒèµ„æºçš„configMap</span>
<span style="color:#75715e"># åŸºäºpatchesStrategicMergeå¯¹ä¸åŒç¯å¢ƒçš„deployment-podèµ„æºè¿›è¡Œæ§åˆ¶</span>
<span style="color:#75715e"># åŸºäºCross-Cuttingå¯¹ä¸åŒç¯å¢ƒçš„namespaceã€name-prefixè¿›è¡Œå®šåˆ¶</span>
<span style="color:#66d9ef">apiVersion</span>: kustomize.config.k8s.io/v1beta1
<span style="color:#66d9ef">kind</span>: Kustomization
<span style="color:#66d9ef">resources</span>:
- ../../base
<span style="color:#66d9ef">namePrefix</span>: production-
<span style="color:#66d9ef">namespace</span>: production
<span style="color:#66d9ef">configMapGenerator</span>:
- <span style="color:#66d9ef">envs</span>:
  - .env
  <span style="color:#66d9ef">name</span>: saken-config
<span style="color:#66d9ef">patchesStrategicMerge</span>:
- deployment_patch.yaml
<span style="color:#66d9ef">images</span>:
- <span style="color:#66d9ef">name</span>: my-registry.com/shovel/shovel-gitops
  <span style="color:#66d9ef">newTag</span>: 940638fd88cf1c030e3c02b21f2df738db8544f3
</code></pre></div><p>é€šè¿‡kustomize edit å‘½ä»¤ï¼Œæ”¯æŒæˆ‘ä»¬åœ¨CIé˜¶æ®µå¯¹åŸºç¡€é…ç½®ä»“åº“çš„kustomizationæ–‡ä»¶è¿›è¡Œå‘½ä»¤å¼çš„ç¼–è¾‘ã€‚</p>
<h4 id="gitlab-ciæµç¨‹">Gitlab CIæµç¨‹</h4>
<p>é¦–å…ˆéœ€è¦é…ç½®å¥½CIæµç¨‹æ‰€éœ€è¦çš„ç¯å¢ƒå˜é‡ï¼Œé€šè¿‡Gitlab settings-&gt;CI/CD-&gt;Variablesè¿›è¡Œé…ç½®å¦‚ä¸‹å˜é‡</p>
<pre><code>DOCKER_REGISTRY_HOST
DOCKER_REGISTRY_IMAGE
DOCKER_REGISTRY_PWD
DOCKER_REGISTRY_USER
GITLAB_EMAIL
GITLAB_ID_RSA
GITLAB_REMOTE_URL
GITLAB_USERNAME
</code></pre><p>å¦‚ä¸‹æ‰€ç¤ºï¼ŒGitlab-CIæµç¨‹ï¼Œå®šä¹‰äº†ä¸¤ä¸ªstage:</p>
<ul>
<li>build-publish-imageï¼šDockeré•œåƒæ„å»ºå¹¶æ¨é€åˆ°è¿œç¨‹ä»“åº“</li>
<li>update-kustomizeï¼šæ›´æ–°å¯¹åº”åˆ†æ”¯çš„kustomize overlayä¸‹kustomizationæ–‡ä»¶ï¼Œå¹¶æ¨é€åˆ°ç¯å¢ƒé…ç½®ä»“åº“</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">stages</span>:
  - build-publish-image
  - update-kustomize

<span style="color:#66d9ef">build-publish-image</span>:
  <span style="color:#66d9ef">image</span>: ccr.ccs.tencentyun.com/shovel/ci-base:<span style="color:#ae81ff">0.0.7</span>
  <span style="color:#66d9ef">stage</span>: build-publish-image
  <span style="color:#66d9ef">tags</span>:
    - docker-runner
  <span style="color:#66d9ef">only</span>:
    - staging
    - main
  <span style="color:#66d9ef">services</span>:
    - <span style="color:#66d9ef">name</span>: docker:<span style="color:#ae81ff">20</span>-dind
  <span style="color:#66d9ef">before_script</span>:
    - make login-docker-registry registry-user=$DOCKER_REGISTRY_USER registry-password=$DOCKER_REGISTRY_PWD registry-host=$DOCKER_REGISTRY_HOST
  <span style="color:#66d9ef">script</span>:
    - make build-release-image release-image=$DOCKER_REGISTRY_HOST/$DOCKER_REGISTRY_IMAGE:$CI_COMMIT_SHA
    - make push-release-image release-image=$DOCKER_REGISTRY_HOST/$DOCKER_REGISTRY_IMAGE:$CI_COMMIT_SHA

<span style="color:#66d9ef">update-kustomize</span>:
  <span style="color:#66d9ef">image</span>: ccr.ccs.tencentyun.com/shovel/ci-base:<span style="color:#ae81ff">0.0.7</span>
  <span style="color:#66d9ef">stage</span>: update-kustomize
  <span style="color:#66d9ef">tags</span>:
    - docker-runner
  <span style="color:#66d9ef">only</span>:
    - staging
    - main
  <span style="color:#66d9ef">services</span>:
    - <span style="color:#66d9ef">name</span>: docker:<span style="color:#ae81ff">20</span>-dind
  <span style="color:#66d9ef">before_script</span>:
    - eval $(ssh-agent -s)
    - echo <span style="color:#e6db74">&#34;${GITLAB_ID_RSA}&#34;</span> | tr -d <span style="color:#e6db74">&#39;\r&#39;</span> | ssh-add - &gt; /dev/<span style="color:#66d9ef">null</span>
    - mkdir -p ~/.ssh
    - ssh-keyscan gitlab.com &gt;&gt; ~/.ssh/known_hosts
    - git remote set-url origin $GITLAB_REMOTE_URL
    - git config --global user.email $GITLAB_EMAIL
    - git config --global user.name $GITLAB_USERNAME
    - if [ <span style="color:#e6db74">&#34;$CI_COMMIT_BRANCH&#34;</span> == <span style="color:#e6db74">&#34;main&#34;</span> ]; then KUSTOMIZE_OVERLAY=<span style="color:#e6db74">&#34;production&#34;</span>; fi
    - if [ <span style="color:#e6db74">&#34;$CI_COMMIT_BRANCH&#34;</span> == <span style="color:#e6db74">&#34;staging&#34;</span> ]; then KUSTOMIZE_OVERLAY=<span style="color:#e6db74">&#34;staging&#34;</span>; fi
  <span style="color:#66d9ef">script</span>:
    - git checkout -B ${CI_COMMIT_BRANCH}
    - cd .kubernetes/overlays/${KUSTOMIZE_OVERLAY}
    - kustomize edit set image $DOCKER_REGISTRY_HOST/$DOCKER_REGISTRY_IMAGE:$CI_COMMIT_SHA
    - kustomize build .
    - git commit -am <span style="color:#e6db74">&#39;[skip ci] staging kustomize update&#39;</span>
    - git push origin ${CI_COMMIT_BRANCH}
</code></pre></div><p>è¿›è¡Œåˆ°è¿™é‡Œå°±å®Œæˆäº†GitOps CIé˜¶æ®µçš„æµç¨‹ã€‚</p>
<h4 id="argo-cdæµç¨‹">Argo CDæµç¨‹</h4>
<ul>
<li>å®‰è£…</li>
</ul>
<p>ç”±äºæ˜¯å®éªŒç¯å¢ƒï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥ä½¿ç”¨è½»é‡çº§ï¼ˆé HAï¼‰ç‰ˆæœ¬è¿›è¡Œå®‰è£…ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
</code></pre></div><p>å®‰è£…å®ŒæˆåDeploymentçŠ¶æ€å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$kubectl get deploy --namespace argocd
NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
argocd-redis                       1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           1h
argocd-server                      1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           1h
argocd-notifications-controller    1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           1h
argocd-applicationset-controller   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           1h
argocd-dex-server                  1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           1h
argocd-repo-server                 1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           1h
</code></pre></div><p>webæœåŠ¡é…ç½®ï¼šå¯ä»¥é€šè¿‡é…ç½®Ingressè·¯ç”±æ˜ å°„åˆ°argocd-server443/80ç«¯å£ï¼›æˆ–è€…ç®€å•é€šè¿‡port-forwardå®ç°ã€‚</p>
<p>è·å–admin passwordï¼šç¬¬ä¸€æ¬¡å®‰è£…å®Œæˆåï¼Œéœ€è¦è·å–argocdå‘½åç©ºé—´ä¸‹secret-argocd-initial-admin-secretè·å–åˆ°åˆå§‹åŒ–çš„admin passwordè¿›è¡Œç™»å½•ï¼›å®Œæˆå¯†ç ä¿®æ”¹åå³å¯åˆ é™¤è¯¥secretã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.data.password}&#34;</span> | base64 -d; echo
</code></pre></div><p>ä½¿ç”¨CLIè¿›è¡Œæ“ä½œï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># å®‰è£…CLI</span>
VERSION<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>curl --silent <span style="color:#e6db74">&#34;https://api.github.com/repos/argoproj/argo-cd/releases/latest&#34;</span> | grep <span style="color:#e6db74">&#39;&#34;tag_name&#34;&#39;</span> | sed -E <span style="color:#e6db74">&#39;s/.*&#34;([^&#34;]+)&#34;.*/\1/&#39;</span><span style="color:#66d9ef">)</span>
curl -sSL -o /usr/local/bin/argocd https://github.com/argoproj/argo-cd/releases/download/$VERSION/argocd-linux-amd64
chmod +x /usr/local/bin/argocd

<span style="color:#75715e"># ä½¿ç”¨CLIç™»å½•</span>
argocd login my.argocd.k8s.com
<span style="color:#75715e"># argocd -h æŸ¥çœ‹argocdçš„ä¸€äº›åŸºæœ¬æ“ä½œå¸®åŠ©</span>
</code></pre></div><ul>
<li>é…ç½®Kubernetes Cluster</li>
</ul>
<p>é€šè¿‡CLIæ·»åŠ æœ¬åœ°kube configä¸­çš„clusteråˆ°argo cdï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">argocd cluster add production-cluster
</code></pre></div><ul>
<li>åˆ›å»ºProjects</li>
</ul>
<p>Projectsæä¾›äº†åº”ç”¨ç¨‹åºçš„é€»è¾‘åˆ†ç»„ï¼Œä¸€èˆ¬ä¸ºå…¬å¸å†…éƒ¨çš„å¤šä¸ªå›¢é˜Ÿã€å¤šä¸ªé¡¹ç›®ç»„åšåŒºåˆ†ä¸æä¾›èµ„æºé™åˆ¶ã€‚Projectså¯¹åº”çš„CRDæ˜¯<code>appprojects.argoproj.io </code>,å¯¹åº”çš„specè§„èŒƒäº†èµ„æºé™åˆ¶æ¡ä»¶ï¼Œå®šä¹‰é¡¹ç›®è§’è‰²ä»¥æä¾›åº”ç”¨ç¨‹åºRBACï¼Œå¦‚ä¸‹æ˜¯é»˜è®¤default projectsï¼›</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#66d9ef">spec</span>:
<span style="color:#75715e"># é™åˆ¶å¯ä»¥éƒ¨ç½²çš„Gitæºå­˜å‚¨åº“</span>
  <span style="color:#66d9ef">sourceRepos</span>:
  - <span style="color:#e6db74">&#39;*&#39;</span>
  <span style="color:#66d9ef">destinations</span>:
  <span style="color:#75715e"># åˆ¶åº”ç”¨ç¨‹åºå¯ä»¥éƒ¨ç½²çš„ç›®æ ‡é›†ç¾¤å’Œå‘½åç©ºé—´</span>
  - <span style="color:#66d9ef">namespce</span>: <span style="color:#e6db74">&#39;*&#39;</span>
    <span style="color:#75715e"># å¦‚æœåº”ç”¨ç¨‹åºæ¸…å•äºç§æœ‰å­˜å‚¨åº“ä¸­ï¼Œåˆ™å¿…é¡»é…ç½®å­˜å‚¨åº“å‡­æ®ã€‚Argo CD æ”¯æŒ HTTPS å’Œ SSH Git å‡­è¯ã€‚</span>
    <span style="color:#66d9ef">server</span>: <span style="color:#e6db74">&#39;*&#39;</span>
  <span style="color:#75715e"># é™åˆ¶å¯ä»¥éƒ¨ç½²æˆ–ä¸å¯ä»¥éƒ¨ç½²çš„Kubernetesèµ„æºç±»å‹(Deployment,DaemonSets...)</span>
  <span style="color:#66d9ef">clusterResourceWhitelist</span>:
  - <span style="color:#66d9ef">group</span>: <span style="color:#e6db74">&#39;*&#39;</span>
    <span style="color:#66d9ef">kind</span>: <span style="color:#e6db74">&#39;*&#39;</span>
</code></pre></div><p>é€šè¿‡CLIé…ç½®Projectså¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">argocd proj create --help
Create a project

Usage:
  argocd proj create PROJECT <span style="color:#f92672">[</span>flags<span style="color:#f92672">]</span>
</code></pre></div><p>é€šè¿‡Web UIé…ç½®Projects:é€šè¿‡åœ¨settings-&gt;projectsä¸‹åˆ›å»ºå¹¶ç¼–è¾‘ä½¿ç”¨ã€‚</p>
<ul>
<li>é…ç½®Repository</li>
</ul>
<p>å¦‚æœåº”ç”¨ç¨‹åºä½äºç§æœ‰å­˜å‚¨åº“ä¸­ï¼Œåˆ™å¿…é¡»é…ç½®å­˜å‚¨åº“å‡­æ®ã€‚Argo CDæ”¯æŒHTTPS/SSH Gitå‡­è¯ã€‚
é€šè¿‡CLIé…ç½®Repositorieså¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">argocd repo add --help
Add git repository connection parameters

Usage:
  argocd repo add REPOURL <span style="color:#f92672">[</span>flags<span style="color:#f92672">]</span>

Examples:
  <span style="color:#75715e"># Add a Git repository via SSH using a private key for authentication, ignoring the server&#39;s host key:</span>
  argocd repo add git@git.example.com:repos/repo --insecure-ignore-host-key --ssh-private-key-path ~/id_rsa
</code></pre></div><p>é€šè¿‡Web UIé…ç½®Repositories:é€šè¿‡åœ¨Settings/Repositoriesä¸‹CONNECT REPOè¿›è¡Œè¿æ¥æµ‹è¯•ä¸åˆ›å»ºã€‚</p>
<ul>
<li>é…ç½®Application</li>
</ul>
<p>æ¥ä¸‹æ¥å°±å¯ä»¥åˆ›å»ºApplicationï¼Œåˆ›å»ºåå³åˆ›å»ºäº†å¯¹åº”çš„Application Kubernetes CRDèµ„æº<code>applications.argoproj.io</code>ï¼ŒArgo CDå®ç°çš„GitOps Controllerä¼šè‡ªåŠ¨å°†Application Gitä»“åº“é‡Œçš„é…ç½®æ¸…å•éƒ¨ç½²åˆ°æŒ‡å®šçš„Kubernetesé›†ç¾¤ä¸Šã€‚</p>
<p>é€šè¿‡CLIé…ç½®Applicationå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"> argocd app create --help
Create an application

Usage:
  argocd app create APPNAME <span style="color:#f92672">[</span>flags<span style="color:#f92672">]</span>

Examples:
        <span style="color:#75715e"># Create a Kustomize app</span>
        argocd app create kustomize-guestbook --repo https://github.com/argoproj/argocd-example-apps.git --path kustomize-guestbook --dest-namespace default --dest-server https://kubernetes.default.svc --kustomize-image gcr.io/heptio-images/ks-guestbook-demo:0.1
</code></pre></div><p>å…¶ä¸­ä¸€äº›å‚æ•°&hellip;</p>
<ul>
<li>&ndash;repo æŒ‡å®šéƒ¨ç½²åº”ç”¨å¯¹åº”çš„Gitä»“åº“åœ°å€</li>
<li>&ndash;path éƒ¨ç½²åº”ç”¨å¯¹åº”çš„ manifest ä½ç½®</li>
<li>&ndash;dest-server ç›®æ ‡ Kubernetes é›†ç¾¤åœ°å€</li>
</ul>
<p>é€šè¿‡Web UIåˆ›å»ºApplicationå¯ä»¥é€šè¿‡NEW APPè¿›è¡Œåˆ›å»ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

<div class="post-img-view">
    <a data-fancybox="gallery" data-src="/_attachment/c1ffb6b4bc3a840ad18053f4b102ebfd_MD5.png">
    <img src="/_attachment/c1ffb6b4bc3a840ad18053f4b102ebfd_MD5.png" alt="image"  />
    </a>
</div>

<div class="post-img-view">
    <a data-fancybox="gallery" data-src="/_attachment/0f1182a39ee98b11b62f8c7958abe64b_MD5.png">
    <img src="/_attachment/0f1182a39ee98b11b62f8c7958abe64b_MD5.png" alt="image"  />
    </a>
</div></p>
<p>åˆ›å»ºå®Œæˆåï¼Œå¦‚æœé€‰æ‹©çš„åŒæ­¥ç­–ç•¥ä¸ºautomatedï¼ŒArgo CDä¼šè‡ªåŠ¨åŒæ­¥é¡¹ç›®çš„manifestéƒ¨ç½²åˆ°å¯¹åº”çš„é›†ç¾¤ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨WEB UIé€šè¿‡SYNCæˆ–è€…CLIé€šè¿‡<code>argocd app sync shovel-gitops-production</code>è¿›æ­¥æ‰‹åŠ¨åŒæ­¥ã€‚</p>
<p>åŒæ­¥å®Œæˆåå¯ä»¥åœ¨WEB UIä¸Šçœ‹åˆ°å¯¹åº”åº”ç”¨çš„åŒæ­¥çŠ¶æ€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

<div class="post-img-view">
    <a data-fancybox="gallery" data-src="/_attachment/9a6ed6e70efdf3bc6a82a7adebf40357_MD5.png">
    <img src="/_attachment/9a6ed6e70efdf3bc6a82a7adebf40357_MD5.png" alt="image"  />
    </a>
</div>

<div class="post-img-view">
    <a data-fancybox="gallery" data-src="/_attachment/104ae6f22daf2bfaaaf199ddb24b1b6f_MD5.png">
    <img src="/_attachment/104ae6f22daf2bfaaaf199ddb24b1b6f_MD5.png" alt="image"  />
    </a>
</div></p>
<ul>
<li>è‡ªåŠ¨åŒæ­¥ç­–ç•¥ï¼ˆSYNC POLICYï¼‰</li>
</ul>
<p>Argo CDèƒ½å¤Ÿåœ¨æ£€æµ‹åˆ° Git ä¸­æ‰€éœ€çš„æ¸…å•ä¸é›†ç¾¤ä¸­çš„å®æ—¶çŠ¶æ€ä¹‹é—´å­˜åœ¨å·®å¼‚æ—¶è‡ªåŠ¨åŒæ­¥åº”ç”¨ç¨‹åºã€‚è‡ªåŠ¨åŒæ­¥æ˜¯GitOps Pullæ¨¡å¼çš„æ ¸å¿ƒï¼Œå¥½å¤„æ˜¯ CI/CD Pipeline ä¸å†éœ€è¦ç›´æ¥è®¿é—®Argo CD APIæœåŠ¡å™¨æ¥æ‰§è¡Œéƒ¨ç½²ï¼Œå¯ä»¥é€šè¿‡åœ¨WEB UIçš„Application-SYNC POLICYä¸­å¯ç”¨<code>AUTOMATED</code>æˆ–CLI<code>argocd app set &lt;APPNAME&gt; --sync-policy automated</code> è¿›è¡Œé…ç½®ã€‚</p>
<ul>
<li>è‡ªåŠ¨ä¿®å‰ªï¼ˆAutomatic Pruningï¼‰</li>
</ul>
<p>è‡ªåŠ¨ä¿®å‰ªä½œä¸ºä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œå½“Argo CDæ£€æµ‹åˆ°èµ„æºä¸å†å­˜åœ¨äºGitä¸­çš„ç¯å¢ƒé…ç½®å®šä¹‰æ—¶ï¼Œè‡ªåŠ¨åŒæ­¥ä¸ä¼šåˆ é™¤èµ„æºã€‚å¯ä»¥é€šè¿‡æ‰‹åŠ¨åŒæ­¥ï¼ˆæ£€æŸ¥ä¿®å‰ªï¼‰æˆ–è€…é€šè¿‡WEB UIçš„Application-SYNC POLICYä¸­å¯ç”¨<code>PRUNE RESOURCES</code>æˆ–CLI<code>argocd app set &lt;APPNAME&gt; --auto-prune</code>è¿›è¡Œé…ç½®ã€‚</p>
<ul>
<li>è‡ªåŠ¨ä¿®å¤ï¼ˆAutomatic Self-Healingï¼‰</li>
</ul>
<p>è‡ªåŠ¨ä¿®å¤ä½œä¸ºä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œå½“æˆ‘ä»¬ç›´æ¥å¯¹é›†ç¾¤è¿›è¡Œæ“ä½œå¯¼è‡´å®æ—¶é›†ç¾¤çš„çŠ¶æ€åç¦»Gitä¸­çš„ç¯å¢ƒé…ç½®å®šä¹‰çš„çŠ¶æ€æ—¶ï¼ŒArgo CDä¼šè‡ªåŠ¨è¿›è¡Œä¿®å¤ï¼Œä¿æŒé›†ç¾¤çš„çŠ¶æ€ä¸Git manifestçš„ä¸€è‡´æ€§ã€‚å¯ä»¥é€šè¿‡WEB UIçš„Application-SYNC POLICYä¸­å¯ç”¨<code>SELF HEAL</code>æˆ–CLI<code>argocd app set &lt;APPNAME&gt; --self-heal</code>è¿›è¡Œé…ç½®ã€‚</p>
<p>æ›´å¤šArgo CDçš„é…ç½®å¯ä»¥å‚è€ƒï¼š<a href="https://argo-cd.readthedocs.io/en/stable/user-guide/">https://argo-cd.readthedocs.io/en/stable/user-guide/</a></p>
<h3 id="é¡¹ç›®æºç ">é¡¹ç›®æºç </h3>
<p>å¯ä»¥åœ¨Githubä¸Šè·å–åˆ°æ­¤é¡¹ç›®çš„æºç ï¼š<a href="https://github.com/ChinaLHR/shovel-kustomize-argocd-gitops">https://github.com/ChinaLHR/shovel-kustomize-argocd-gitops</a></p>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<ul>
<li><a href="https://argo-cd.readthedocs.io/en/stable/">https://argo-cd.readthedocs.io/en/stable/</a></li>
<li><a href="https://www.weave.works/technologies/gitops/">https://www.weave.works/technologies/gitops/</a></li>
<li><a href="https://harness.io/blog/helm-vs-kustomize">https://harness.io/blog/helm-vs-kustomize</a></li>
</ul>
        </p>
    </div>
</div>

<aside class="post-toc">
    <nav id="toc">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#gitops">GitOps</a>
          <ul>
            <li><a href="#ä»€ä¹ˆæ˜¯gitops">ä»€ä¹ˆæ˜¯GitOps</a></li>
            <li><a href="#ä½¿ç”¨gitopsçš„å‰ç½®æ¡ä»¶">ä½¿ç”¨GitOpsçš„å‰ç½®æ¡ä»¶</a></li>
            <li><a href="#ä¸å¯å˜åŸºç¡€è®¾æ–½iacä¸gitops">ä¸å¯å˜åŸºç¡€è®¾æ–½ã€IaCä¸GitOps</a></li>
            <li><a href="#gitopsçš„å·¥ä½œæ¨¡å¼">GitOpsçš„å·¥ä½œæ¨¡å¼</a></li>
            <li><a href="#gitopsçš„ä¼˜åŠ¿">GitOpsçš„ä¼˜åŠ¿</a></li>
          </ul>
        </li>
        <li><a href="#argo-cd">Argo CD</a>
          <ul>
            <li><a href="#argo-cdç‰¹æ€§">Argo CDç‰¹æ€§</a></li>
            <li><a href="#argo-cdæ¶æ„">Argo CDæ¶æ„</a></li>
            <li><a href="#argo-cdéƒ¨ç½²">Argo CDéƒ¨ç½²</a></li>
          </ul>
        </li>
        <li><a href="#ä½¿ç”¨kustomizeå®šåˆ¶ç®¡ç†kubernetesèµ„æº">ä½¿ç”¨Kustomizeå®šåˆ¶/ç®¡ç†Kubernetesèµ„æº</a>
          <ul>
            <li><a href="#å…³äºkustomize">å…³äºKustomize</a></li>
            <li><a href="#ä½¿ç”¨kustomizeå®šåˆ¶ç®¡ç†kubernetesèµ„æº-1">ä½¿ç”¨Kustomizeå®šåˆ¶/ç®¡ç†Kubernetesèµ„æº</a></li>
            <li><a href="#åŸºå‡†basesä¸è¦†ç›–overlays">åŸºå‡†ï¼ˆBasesï¼‰ä¸è¦†ç›–ï¼ˆOverlaysï¼‰</a></li>
            <li><a href="#kustomize-vs-helm">Kustomize Vs Helm</a></li>
          </ul>
        </li>
        <li><a href="#åŸºäºgitlab-cikustomize-argo-cdçš„gitopså®è·µ">åŸºäºGitlab CIã€Kustomizeã€ Argo CDçš„GitOpså®è·µ</a>
          <ul>
            <li><a href="#å‰ç½®æ¡ä»¶">å‰ç½®æ¡ä»¶</a></li>
            <li><a href="#gitopsæµç¨‹">GitOpsæµç¨‹</a></li>
            <li><a href="#é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</a></li>
            <li><a href="#gitopsæµç¨‹å®è·µ">GitOpsæµç¨‹å®è·µ</a>
              <ul>
                <li><a href="#åº”ç”¨dockeré•œåƒæ„å»º">åº”ç”¨Dockeré•œåƒæ„å»º</a></li>
                <li><a href="#kustomizeå®šåˆ¶å£°æ˜å¼kubernetesèµ„æºå¯¹è±¡">Kustomizeå®šåˆ¶å£°æ˜å¼Kubernetesèµ„æºå¯¹è±¡</a></li>
                <li><a href="#gitlab-ciæµç¨‹">Gitlab CIæµç¨‹</a></li>
                <li><a href="#argo-cdæµç¨‹">Argo CDæµç¨‹</a></li>
              </ul>
            </li>
            <li><a href="#é¡¹ç›®æºç ">é¡¹ç›®æºç </a></li>
          </ul>
        </li>
        <li><a href="#å‚è€ƒ">å‚è€ƒ</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </nav>
</aside>



    

        </main><footer class="footer">
    <span>&copy; 2023 hanrong.li</span>
    <span>
        Made with &#10084;&#65039; using <a target="_blank" href="https://github.com/526avijitgupta/gokarna">Gokarna</a>
    </span>
</footer>
</body>
</html>
