<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #FF4D4D;
        }
    </style>

    
    
    
    
    
    

    
    <title>Spring WebFlux åŸç†ä¸é€‚ç”¨åœºæ™¯</title>
    <meta name="description" content="keep curious ğŸ˜¼">
    <meta name="keywords" content='blog, chinalhr, lhr, Java, Spring, WebFlux, å“åº”å¼ç¼–ç¨‹'>

    <meta property="og:url" content="https://chinalhr.github.io/post/spring-webflux-principle/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Spring WebFlux åŸç†ä¸é€‚ç”¨åœºæ™¯">
    <meta property="og:description" content="keep curious ğŸ˜¼">
    <meta property="og:image" content="https://user-images.githubusercontent.com/19829495/188320707-5b468cc9-bea4-486c-b591-57ff8324e41c.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Spring WebFlux åŸç†ä¸é€‚ç”¨åœºæ™¯">
    <meta name="twitter:description" content="keep curious ğŸ˜¼">
    <meta property="twitter:domain" content="https://chinalhr.github.io/post/spring-webflux-principle/">
    <meta property="twitter:url" content="https://chinalhr.github.io/post/spring-webflux-principle/">
    <meta name="twitter:image" content="https://user-images.githubusercontent.com/19829495/188320707-5b468cc9-bea4-486c-b591-57ff8324e41c.jpg">

    
    <link rel="canonical" href="https://chinalhr.github.io/post/spring-webflux-principle/" />

    <link rel="stylesheet" type="text/css" href="https://chinalhr.github.io//css/normalize.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" type="text/css" href="https://chinalhr.github.io//css/main.css">
    <link disabled id="dark-theme" rel="stylesheet" href="https://chinalhr.github.io//css/dark.css">

    <script src="https://chinalhr.github.io//js/svg-injector.min.js"></script>
    <script src="https://chinalhr.github.io//js/feather-icons.min.js"></script>
    <script src="https://chinalhr.github.io//js/main.js"></script>

    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JLJBQBW5WM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){window.dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JLJBQBW5WM');
</script>
  
    
    
    
</head>
<body>
        <script type="text/javascript">
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        
        <div class="avatar">
            <a href="https://chinalhr.github.io/">
                <img src="https://user-images.githubusercontent.com/19829495/188320707-5b468cc9-bea4-486c-b591-57ff8324e41c.jpg" alt="avatar" />
            </a>
        </div>
        

        <div class="nav-title">
            <a class="nav-brand" href="https://chinalhr.github.io/">LHR</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="https://chinalhr.github.io/"><span data-feather='home'></span> Home </a>
            </div>
            
            <div class="nav-link">
                <a href="https://chinalhr.github.io/post/"><span data-feather='book'></span> Posts </a>
            </div>
            
            <div class="nav-link">
                <a href="https://chinalhr.github.io/tags/"><span data-feather='tag'></span> Tags </a>
            </div>
            
            <div class="nav-link">
                <a href="https://chinalhr.github.io/projects/"><span data-feather='code'></span> Projects </a>
            </div>
            
            <div class="nav-link">
                <a href="https://chinalhr.github.io/about/"><span data-feather='user'></span> About </a>
            </div>
            
            <div class="nav-link">
                <a href="https://github.com/chinalhr"><span data-feather='github'></span>  </a>
            </div>
            
            <div class="nav-link">
                <a href="https://chinalhr.github.io/index.xml"><span data-feather='rss'></span>  </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span id="dark-theme-toggle-screen-reader-target" class="sr-only"></span>
                <a>
                    <span id="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span id="hamburger-menu-toggle-screen-reader-target" class="sr-only">menu</span>
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="https://chinalhr.github.io/"><span data-feather='home'></span> Home </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://chinalhr.github.io/post/"><span data-feather='book'></span> Posts </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://chinalhr.github.io/tags/"><span data-feather='tag'></span> Tags </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://chinalhr.github.io/projects/"><span data-feather='code'></span> Projects </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://chinalhr.github.io/about/"><span data-feather='user'></span> About </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://github.com/chinalhr"><span data-feather='github'></span>  </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://chinalhr.github.io/index.xml"><span data-feather='rss'></span>  </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span id="dark-theme-toggle-screen-reader-target" class="sr-only">theme</span>
                    <a>
                        <span id="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>Spring WebFlux åŸç†ä¸é€‚ç”¨åœºæ™¯</h1>
        <small role="doc-subtitle"></small>
        <p class="post-date">
            February 13, 2020
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="https://chinalhr.github.io/tags/java">Java</a></li>
        
            <li class="post-tag"><a href="https://chinalhr.github.io/tags/spring">Spring</a></li>
        
            <li class="post-tag"><a href="https://chinalhr.github.io/tags/webflux">WebFlux</a></li>
        
            <li class="post-tag"><a href="https://chinalhr.github.io/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B">å“åº”å¼ç¼–ç¨‹</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <p>
            <blockquote>
<p>Spring WebFluxæºç åˆ†æä¸é€‚ç”¨åœºæ™¯</p>
</blockquote>
<h2 id="å…³äºwebflux">å…³äºWebFlux</h2>
<p>Spring Framework 5æä¾›äº†å®Œæ•´çš„ç«¯åˆ°ç«¯å“åº”å¼ç¼–ç¨‹çš„æ”¯æŒã€‚è¿™æ˜¯ä¸€ç§ä¸åŒäºServletçš„å…¨æ–°çš„ç¼–ç¨‹èŒƒå¼å’ŒæŠ€æœ¯æ ˆï¼Œå®ƒåŸºäºå¼‚æ­¥éé˜»å¡çš„ç‰¹æ€§ï¼Œèƒ½å¤Ÿå€ŸåŠ©EventLoopä»¥å°‘é‡çº¿ç¨‹åº”å¯¹é«˜å¹¶å‘çš„è®¿é—®ï¼Œå¯¹å¾®æœåŠ¡æ¶æ„ä¹Ÿé¢‡æœ‰åŠ©ç›Šã€‚</p>
<p><img src="https://user-images.githubusercontent.com/19829495/74244715-d23f2c80-4d1c-11ea-81c2-80e8b47f555f.png" alt=""></p>
<p>æ”¯æŒSpring 5çš„Spring Boot 2.0æ¥è¯´ï¼Œæ–°åŠ å…¥çš„å“åº”å¼æŠ€æœ¯æ ˆæ˜¯å…¶ä¸»æ‰“æ ¸å¿ƒç‰¹æ€§ã€‚å…·ä½“æ¥è¯´ï¼ŒSpring Boot 2æ”¯æŒçš„å“åº”å¼æŠ€æœ¯æ ˆåŒ…æ‹¬å¦‚ä¸‹ï¼š</p>
<ul>
<li>Spring Framework 5æä¾›çš„éé˜»å¡webæ¡†æ¶Spring Webfluxï¼›</li>
<li>éµå¾ªå“åº”å¼æµè§„èŒƒçš„å…„å¼Ÿé¡¹ç›®Reactorï¼›</li>
<li>æ”¯æŒå¼‚æ­¥I/Oçš„Nettyã€Undertowç­‰æ¡†æ¶ï¼Œä»¥åŠåŸºäºServlet 3.1+çš„å®¹å™¨ï¼ˆå¦‚Tomcat 8.0.23+å’ŒJetty 9.0.4+ï¼‰ï¼›</li>
<li>æ”¯æŒå“åº”å¼çš„æ•°æ®è®¿é—®Spring Data Reactive Repositoriesï¼›</li>
<li>æ”¯æŒå“åº”å¼çš„å®‰å…¨è®¿é—®æ§åˆ¶Spring Security Reactiveï¼›</li>
</ul>
<h2 id="webfluxå¯¹æ¯”springmvcå¹¶å‘æ¨¡å‹">WebFluxå¯¹æ¯”SpringMVCå¹¶å‘æ¨¡å‹</h2>
<h4 id="springmvcåŸºäºçš„servletå¹¶å‘æ¨¡å‹">SpringMVCåŸºäºçš„Servletå¹¶å‘æ¨¡å‹</h4>
<p>servletç”±servlet containerè¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚containerå¯åŠ¨æ—¶æ„é€ servletå¯¹è±¡å¹¶è°ƒç”¨servlet init()è¿›è¡Œåˆå§‹åŒ–ï¼›containerå…³é—­æ—¶è°ƒç”¨servlet destory()é”€æ¯servletï¼›containerè¿è¡Œæ—¶æ¥å—è¯·æ±‚ï¼Œå¹¶ä¸ºæ¯ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸€èˆ¬ä»çº¿ç¨‹æ± ä¸­è·å–ç©ºé—²çº¿ç¨‹ï¼‰ç„¶åè°ƒç”¨service()ã€‚</p>
<p><img src="https://user-images.githubusercontent.com/19829495/55001956-ac2f7180-5010-11e9-80cf-cd34a57832b1.png" alt="image"></p>
<p>å¤„ç†è¯·æ±‚çš„æ—¶å€™åŒæ­¥æ“ä½œï¼Œä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ï¼Œå¹¶å‘ä¸Šå‡ï¼Œçº¿ç¨‹æ•°é‡å°±ä¼šä¸Šæ¶¨ï¼ˆä¸Šçº¿æ–‡åˆ‡æ¢ï¼Œå†…å­˜æ¶ˆè€—å¤§ï¼‰å½±å“è¯·æ±‚çš„å¤„ç†æ—¶é—´ã€‚ç°ä»£ç³»ç»Ÿå¤šæ•°éƒ½æ˜¯IOå¯†é›†çš„ï¼ŒåŒæ­¥å¤„ç†è®©çº¿ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½æµªè´¹åœ¨äº†IOç­‰å¾…ä¸Šé¢ã€‚è™½ç„¶Servlet3.0åæä¾›äº†å¼‚æ­¥è¯·æ±‚å¤„ç†ä¸éé˜»å¡IOæ”¯æŒï¼Œä½†æ˜¯ä½¿ç”¨å®ƒä¼šè¿œç¦»Servlet APIçš„å…¶ä½™éƒ¨åˆ†ï¼Œæ¯”å¦‚å…¶è§„èŒƒæ˜¯åŒæ­¥çš„ï¼ˆFilter, Servletï¼‰æˆ–é˜»å¡çš„ï¼ˆgetParameter,getPartï¼‰ï¼Œè€Œä¸”å…¶å¯¹å“åº”çš„å†™å…¥ä»ç„¶æ˜¯é˜»å¡çš„ã€‚</p>
<h4 id="webfluxå¹¶å‘æ¨¡å‹">WebFluxå¹¶å‘æ¨¡å‹</h4>
<p>WebFluxæ¨¡å‹ä¸»è¦ä¾èµ–å“åº”å¼ç¼–ç¨‹åº“Reactorï¼ŒReactor æœ‰ä¸¤ç§æ¨¡å‹ï¼ŒFlux å’Œ Monoï¼Œæä¾›äº†éé˜»å¡ã€æ”¯æŒå›å‹æœºåˆ¶çš„å¼‚æ­¥æµå¤„ç†èƒ½åŠ›ã€‚WebFlux APIæ¥æ”¶æ™®é€šPublisherä½œä¸ºè¾“å…¥ï¼Œåœ¨å†…éƒ¨ä½¿å…¶é€‚é…Reactorç±»å‹ï¼Œä½¿ç”¨å®ƒå¹¶è¿”å›Fluxæˆ–Monoä½œä¸ºè¾“å‡ºã€‚</p>
<p><img src="https://user-images.githubusercontent.com/19829495/55086336-2a5c4880-50e3-11e9-853b-a2a43d917b94.png" alt="image"></p>
<p>WebFlux ä½¿ç”¨Nettyä½œä¸ºé»˜è®¤çš„webæœåŠ¡å™¨ï¼Œå…¶ä¾èµ–äºéé˜»å¡IOï¼Œå¹¶ä¸”æ¯æ¬¡å†™å…¥éƒ½ä¸éœ€è¦é¢å¤–çš„çº¿ç¨‹è¿›è¡Œæ”¯æŒã€‚</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨Tomcatã€Jettyå®¹å™¨ï¼Œä¸åŒä¸SpringMVCä¾èµ–äºServleté˜»å¡IOï¼Œå¹¶å…è®¸åº”ç”¨ç¨‹åºåœ¨éœ€è¦æ—¶ç›´æ¥ä½¿ç”¨Servlet APIï¼ŒWebFluxä¾èµ–äºServlet 3.1éé˜»å¡IOã€‚ä½¿ç”¨Undertowä½œä¸ºæœåŠ¡å™¨æ—¶ï¼ŒWebFluxç›´æ¥ä½¿ç”¨Undertow APIè€Œä¸ä½¿ç”¨Servlet APIã€‚</p>
<p>å½“WebFluxè¿è¡Œåœ¨NettyæœåŠ¡å™¨ä¸Šï¼Œå…¶çº¿ç¨‹æ¨¡å‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://user-images.githubusercontent.com/19829495/78471326-0b1ae100-7763-11ea-8a55-3627e6884ba0.png" alt="å›¾ç‰‡"></p>
<p>NettyServerçš„Boss Groupçº¿ç¨‹æ± å†…çš„äº‹ä»¶å¾ªç¯ä¼šæ¥æ”¶è¿™ä¸ªè¯·æ±‚ï¼Œç„¶åæŠŠå®ŒæˆTCPä¸‰æ¬¡æ¡æ‰‹çš„è¿æ¥channeläº¤ç»™Worker Groupä¸­çš„æŸä¸€ä¸ªäº‹ä»¶å¾ªç¯çº¿ç¨‹æ¥è¿›è¡Œå¤„ç†ï¼ˆè¯¥äº‹ä»¶å¤„ç†çº¿ç¨‹ä¼šè°ƒç”¨å¯¹åº”çš„controllerè¿›è¡Œå¤„ç†ï¼‰ã€‚æ‰€ä»¥WebFluxçš„handleræ‰§è¡Œæ˜¯ä½¿ç”¨Nettyçš„IOçº¿ç¨‹è¿›è¡Œæ‰§è¡Œçš„ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„å¦‚æœhandlerçš„æ‰§è¡Œæ¯”è¾ƒè€—æ—¶ï¼Œä¼šæŠŠIOçº¿ç¨‹è€—å°½å¯¼è‡´ä¸èƒ½å†å¤„ç†å…¶ä»–è¯·æ±‚ï¼Œå¯ä»¥é€šè¿‡Reactorçš„publishOnæ“ä½œç¬¦åˆ‡æ¢åˆ°å…¶ä»–çº¿ç¨‹æ± ä¸­æ‰§è¡Œã€‚</p>
<h2 id="èŒƒä¾‹">èŒƒä¾‹</h2>
<p><strong>å‚è€ƒ</strong></p>
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#webflux">https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#webflux</a></p>
<h2 id="æ€§èƒ½">æ€§èƒ½</h2>
<p>å“åº”å¼å’Œéé˜»å¡å¹¶ä¸æ˜¯æ€»èƒ½è®©åº”ç”¨è·‘çš„æ›´å¿«ï¼Œå†µä¸”å°†ä»£ç æ„å»ºä¸ºéé˜»å¡çš„æ‰§è¡Œæ–¹å¼æœ¬èº«è¿˜ä¼šå¸¦æ¥å°‘é‡çš„æˆæœ¬ã€‚ä½†æ˜¯åœ¨ç±»ä¼¼äºWEBåº”ç”¨è¿™æ ·çš„é«˜å¹¶å‘ã€å°‘è®¡ç®—ä¸”I/Oå¯†é›†çš„åº”ç”¨ä¸­ï¼Œå“åº”å¼å’Œéé˜»å¡å¾€å¾€èƒ½å¤Ÿå‘æŒ¥å‡ºä»·å€¼ã€‚</p>
<p>å¯¹æ¯”SpringMVCä½¿ç”¨çš„Servletæ¨¡å‹ï¼Œå¢åŠ Servletå®¹å™¨å¤„ç†è¯·æ±‚çš„çº¿ç¨‹æ•°é‡å¯ä»¥ç¼“è§£è¿™ä¸€é—®é¢˜ï¼Œä½†æ˜¯å¢åŠ çº¿ç¨‹æ˜¯æœ‰æˆæœ¬çš„ï¼ŒJVMä¸­é»˜è®¤æƒ…å†µä¸‹åœ¨åˆ›å»ºæ–°çº¿ç¨‹æ—¶ä¼šåˆ†é…å¤§å°ä¸º1Mçš„çº¿ç¨‹æ ˆï¼Œæ‰€ä»¥æ›´å¤šçš„çº¿ç¨‹æ„å‘³ç€éœ€è¦æ›´å¤šçš„å†…å­˜ï¼›æ›´å¤šçš„çº¿ç¨‹ä¼šå¸¦æ¥æ›´å¤šçš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ã€‚</p>
<p><img src="https://user-images.githubusercontent.com/19829495/76158113-3c48c700-614d-11ea-831d-55caa6f970f8.png" alt="å›¾ç‰‡"></p>
<h3 id="webfluxå¯¹æ¯”springmvcçš„æ€§èƒ½æµ‹è¯•">webfluxå¯¹æ¯”SpringMVCçš„æ€§èƒ½æµ‹è¯•</h3>
<p><img src="https://user-images.githubusercontent.com/19829495/74248065-ff420e00-4d21-11ea-81fb-5efb2bdf679c.png" alt="å›¾ç‰‡"></p>
<p><img src="https://user-images.githubusercontent.com/19829495/74248685-eb4adc00-4d22-11ea-9437-57724a8ef677.png" alt="å›¾ç‰‡"></p>
<p>å¯¹äºè¿è¡Œåœ¨å¼‚æ­¥IOçš„ä¹‹ä¸Šçš„WebFluxåº”ç”¨æ¥è¯´ï¼Œå…¶å·¥ä½œçº¿ç¨‹æ•°é‡å§‹ç»ˆç»´æŒåœ¨ä¸€ä¸ªå›ºå®šçš„æ•°é‡ä¸Šï¼Œé€šå¸¸è¿™ä¸ªå›ºå®šçš„æ•°é‡ç­‰äºCPUæ ¸æ•°ã€‚ä»æµ‹è¯•å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œéšç€ç”¨æˆ·æ•°çš„å¢å¤šï¼Œwebfluxååé‡åŸºæœ¬å‘ˆçº¿æ€§å¢å¤šçš„è¶‹åŠ¿ï¼Œ95%çš„å“åº”éƒ½åœ¨100ms+çš„å¯æ§èŒƒå›´å†…è¿”å›äº†ï¼Œå¹¶æœªå‡ºç°å»¶æ—¶çš„æƒ…å†µã€‚è€ŒSpringMVCçº¿ç¨‹æ•°è¾¾åˆ°200/400å‰ï¼Œ95%çš„è¯·æ±‚å“åº”æ—¶é•¿æ˜¯æ­£å¸¸çš„ï¼Œä¹‹åå‘ˆç›´çº¿ä¸Šå‡çš„æ€åŠ¿ï¼›</p>
<p><strong>ç»“è®º</strong>ï¼šéé˜»å¡çš„å¤„ç†æ–¹å¼è§„é¿äº†çº¿ç¨‹æ’é˜Ÿç­‰å¾…çš„æƒ…å†µï¼Œä»è€Œå¯ä»¥ç”¨å°‘é‡è€Œå›ºå®šçš„çº¿ç¨‹å¤„ç†åº”å¯¹å¤§é‡è¯·æ±‚çš„å¤„ç†ï¼Œæå‡åº”ç”¨çš„ååé‡å’Œä¼¸ç¼©æ€§ã€‚</p>
<p><a href="https://blog.csdn.net/get_set/article/details/79492439">å‚è€ƒé“¾æ¥</a></p>
<h2 id="webfluxè¯·æ±‚åˆ†å‘">WebFluxè¯·æ±‚åˆ†å‘</h2>
<h3 id="reactorçš„mapflatmapconcatmap">reactorçš„mapï¼ŒflatMapï¼ŒconcatMap</h3>
<ul>
<li>map</li>
</ul>
<p>mapæ˜¯åŒæ­¥éé˜»å¡çš„1å¯¹1çš„è½¬æ¢æ•°æ®å¤„ç†ã€‚mapæ–¹æ³•ç­¾åæ¥å—<code>Function&lt;T, U&gt;</code> è¿”å›<code>Flux&lt;U&gt;</code>ã€‚</p>
<p><img src="https://user-images.githubusercontent.com/19829495/76159129-399f9f00-6158-11ea-99e3-6c75cd5c076e.png" alt="å›¾ç‰‡"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#75715e">//åŒæ­¥æ‰§è¡Œä¹˜æ³•æ“ä½œ
</span><span style="color:#75715e"></span>Flux<span style="color:#f92672">.</span><span style="color:#a6e22e">just</span><span style="color:#f92672">(</span>1<span style="color:#f92672">,</span>2<span style="color:#f92672">,</span>3<span style="color:#f92672">,</span>4<span style="color:#f92672">,</span>5<span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">map</span><span style="color:#f92672">(</span>i<span style="color:#f92672">-&gt;{</span>
                    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                        TimeUnit<span style="color:#f92672">.</span><span style="color:#a6e22e">SECONDS</span><span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
                    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
                    <span style="color:#f92672">}</span>
                    <span style="color:#66d9ef">return</span> i<span style="color:#f92672">*</span>10<span style="color:#f92672">;</span>
                <span style="color:#f92672">})</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">subscribe</span><span style="color:#f92672">(</span>c<span style="color:#f92672">-&gt;</span>log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;getInt:{}&#34;</span><span style="color:#f92672">,</span>c<span style="color:#f92672">));</span>
</code></pre></div><ul>
<li>flatMap</li>
</ul>
<p>flatMapæ˜¯å¼‚æ­¥éé˜»å¡çš„1å¯¹Nçš„è½¬æ¢æ•°æ®å¤„ç†ã€‚flayMapæ–¹æ³•ç­¾åæ¥å—<code>Function&lt;T, Publisher&lt;V&gt;&gt;</code> è¿”å› <code>Flux&lt;V&gt;</code>ã€‚</p>
<p><img src="https://user-images.githubusercontent.com/19829495/76158453-d9f1c580-6150-11ea-960f-0dfb1366f01a.png" alt="å›¾ç‰‡"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//å¼‚æ­¥æ‰§è¡Œä¹˜æ³•
</span><span style="color:#75715e"></span>Flux<span style="color:#f92672">.</span><span style="color:#a6e22e">just</span><span style="color:#f92672">(</span>1<span style="color:#f92672">,</span>2<span style="color:#f92672">,</span>3<span style="color:#f92672">,</span>4<span style="color:#f92672">,</span>5<span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">log</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">flatMap</span><span style="color:#f92672">(</span>i<span style="color:#f92672">-&gt;</span> Flux<span style="color:#f92672">.</span><span style="color:#a6e22e">just</span><span style="color:#f92672">(</span>i<span style="color:#f92672">*</span>10<span style="color:#f92672">).</span><span style="color:#a6e22e">delayElements</span><span style="color:#f92672">(</span>Duration<span style="color:#f92672">.</span><span style="color:#a6e22e">ofSeconds</span><span style="color:#f92672">(</span>1<span style="color:#f92672">)))</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">subscribe</span><span style="color:#f92672">(</span>c <span style="color:#f92672">-&gt;</span>log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;getInt:{}&#34;</span><span style="color:#f92672">,</span>c<span style="color:#f92672">));</span>
</code></pre></div><p><strong>æ€»ç»“</strong>ï¼šflatMapçš„è½¬æ¢Functionè¦æ±‚è¿”å›ä¸€ä¸ªPublisherï¼Œè¿™ä¸ªPublisherä»£è¡¨ä¸€ä¸ªä½œç”¨äºå…ƒç´ çš„å¼‚æ­¥çš„è½¬æ¢æ“ä½œï¼›è€Œmapä»…ä»…æ˜¯åŒæ­¥çš„å…ƒç´ è½¬æ¢æ“ä½œã€‚</p>
<ul>
<li>concatMap</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/19829495/76158351-03f6b800-6150-11ea-8d55-83e7d43143d3.png" alt="å›¾ç‰‡"></p>
<p>concatMap æ“ä½œç¬¦çš„ä½œç”¨æ˜¯æŠŠæµä¸­çš„æ¯ä¸ªå…ƒç´ è½¬æ¢æˆä¸€ä¸ªæµ, å†æŠŠæ‰€æœ‰æµè¿›è¡Œåˆå¹¶. ä¸ flatMapä¸åŒçš„æ˜¯,concatMapä¼šæ ¹æ®åŸå§‹æµä¸­çš„å…ƒç´ é¡ºåºä¾æ¬¡æŠŠè½¬æ¢ä¹‹åçš„æµè¿›è¡Œåˆå¹¶ã€‚</p>
<h3 id="webflux-çš„dispatcherhandler">WebFlux çš„DispatcherHandler</h3>
<p>Spring MVC çš„å‰ç«¯æ§åˆ¶å™¨æ˜¯ DispatcherServletï¼Œè€ŒWebFlux çš„å‰ç«¯æ§åˆ¶å™¨æ˜¯ DispatcherHandlerï¼Œå®ƒå®ç°äº† WebHandleræ¥å£ã€‚DispatcherHandlerå®Œæˆ handler çš„æŸ¥æ‰¾ã€è°ƒç”¨å’Œç»“æœå¤„ç†ç­‰æ­¥éª¤ï¼Œå…³è”çš„Beanå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>Bean ç±»å‹</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>HandlerMapping</code></td>
<td>å°†è¯·æ±‚æ˜ å°„åˆ°å¯¹åº”çš„ handlerã€‚ä¸»è¦çš„ <code>HandlerMapping</code> å®ç°æœ‰å¤„ç† <code>@RequestMapping</code> æ³¨è§£çš„ <code>RequestMappingHandlerMapping</code> ï¼Œå¤„ç†å‡½æ•°è·¯ç”±çš„<code>RouterFunctionMapping</code>ï¼Œä»¥åŠå¤„ç†ç®€å• URL æ˜ å°„çš„ <code>SimpleUrlHandlerMapping</code>ã€‚</td>
</tr>
<tr>
<td><code>HandlerAdapter</code></td>
<td>å¸®åŠ© <code>DispatcherHandler</code> è°ƒç”¨è¯·æ±‚å¯¹åº”çš„ handlerï¼Œè€Œä¸ç”¨å…³å¿ƒè¯¥ handler å…·ä½“çš„è°ƒç”¨æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œè°ƒç”¨ä¸€ä¸ªé€šè¿‡æ³¨è§£çš„æ–¹å¼å®šä¹‰çš„ controller å°±éœ€è¦å¯»æ‰¾å¯¹åº”çš„æ³¨è§£ï¼Œè€Œ <code>HandlerAdapter</code> çš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†å¸®åŠ© <code>DispatcherHandler</code> å±è”½ç±»ä¼¼çš„ç»†èŠ‚.</td>
</tr>
<tr>
<td><code>HandlerResultHandler</code></td>
<td>å¤„ç† handler è°ƒç”¨åçš„ç»“æœï¼Œå¹¶ç”Ÿæˆæœ€åçš„å“åº”ã€‚å‚è€ƒ <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#webflux-resulthandling">Result Handling</a>ã€‚</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">WebHandler</span> <span style="color:#f92672">{</span>

	<span style="color:#75715e">/**
</span><span style="color:#75715e">	 * Handle the web server exchange.
</span><span style="color:#75715e">	 * @param exchange the current server exchange
</span><span style="color:#75715e">	 * @return {@code Mono&lt;Void&gt;} to indicate when request handling is complete
</span><span style="color:#75715e">	 */</span>
	Mono<span style="color:#f92672">&lt;</span>Void<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">handle</span><span style="color:#f92672">(</span>ServerWebExchange exchange<span style="color:#f92672">);</span>

<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DispatcherHandler</span> <span style="color:#66d9ef">implements</span> WebHandler<span style="color:#f92672">,</span> ApplicationContextAware <span style="color:#f92672">{</span>
<span style="color:#f92672">...</span>
    <span style="color:#a6e22e">@Override</span>
	<span style="color:#66d9ef">public</span> Mono<span style="color:#f92672">&lt;</span>Void<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">handle</span><span style="color:#f92672">(</span>ServerWebExchange exchange<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
	<span style="color:#75715e">//æµç¨‹1	
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">handlerMappings</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">return</span> createNotFoundError<span style="color:#f92672">();</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">return</span> Flux<span style="color:#f92672">.</span><span style="color:#a6e22e">fromIterable</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">handlerMappings</span><span style="color:#f92672">)</span>
            <span style="color:#75715e">//æµç¨‹2
</span><span style="color:#75715e"></span>				<span style="color:#f92672">.</span><span style="color:#a6e22e">concatMap</span><span style="color:#f92672">(</span>mapping <span style="color:#f92672">-&gt;</span> mapping<span style="color:#f92672">.</span><span style="color:#a6e22e">getHandler</span><span style="color:#f92672">(</span>exchange<span style="color:#f92672">))</span>
				<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">()</span>
            <span style="color:#75715e">//æµç¨‹3
</span><span style="color:#75715e"></span>				<span style="color:#f92672">.</span><span style="color:#a6e22e">switchIfEmpty</span><span style="color:#f92672">(</span>createNotFoundError<span style="color:#f92672">())</span>
            <span style="color:#75715e">//æµç¨‹4
</span><span style="color:#75715e"></span>				<span style="color:#f92672">.</span><span style="color:#a6e22e">flatMap</span><span style="color:#f92672">(</span>handler <span style="color:#f92672">-&gt;</span> invokeHandler<span style="color:#f92672">(</span>exchange<span style="color:#f92672">,</span> handler<span style="color:#f92672">))</span>
            <span style="color:#75715e">//æµç¨‹5
</span><span style="color:#75715e"></span>				<span style="color:#f92672">.</span><span style="color:#a6e22e">flatMap</span><span style="color:#f92672">(</span>result <span style="color:#f92672">-&gt;</span> handleResult<span style="color:#f92672">(</span>exchange<span style="color:#f92672">,</span> result<span style="color:#f92672">));</span>
	<span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p>ServerWebExchangeå¯¹è±¡æ¯ä¸€æ¬¡ HTTP è¯·æ±‚çš„ä¿¡æ¯ï¼ˆåŒ…æ‹¬è¯·æ±‚å‚æ•°ï¼Œè·¯å¾„ï¼ŒCookieç­‰ï¼‰</p>
<p>ä»DispatcherHandlerçš„handleå®ç°å¯ä»¥çœ‹å‡ºWebFluxçš„è¯·æ±‚åˆ†å‘æµç¨‹ï¼š</p>
<ol>
<li>åˆ¤æ–­æ•´ä¸ªæ¥å£æ˜ å°„ mappingsé›†åˆæ˜¯å¦ä¸ºç©ºï¼Œç©ºåˆ™åˆ›å»ºä¸€ä¸ª Not Found çš„è¯·æ±‚é”™è¯¯å“åº”ï¼›</li>
<li>æ ¹æ®å…·ä½“çš„è¯·æ±‚åœ°å€è·å–å¯¹åº”çš„ handlerMappingï¼ˆå¤„ç†æ–¹æ³•ï¼‰;</li>
<li>handlerMappingä¸ºç©ºçš„è¯æ‰¾ä¸åˆ°å¯¹åº”çš„å¤„ç†æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ª Not Found çš„è¯·æ±‚é”™è¯¯å“åº”ï¼›</li>
<li>é€šè¿‡ invokeHandler æ–¹æ³•æ‰¾åˆ°å¯¹åº”çš„ HandlerAdapter æ¥å®Œæˆè°ƒç”¨</li>
<li>ç”± HandlerResultHandler å¯¹ç»“æœè¿›è¡Œå¤„ç†ï¼Œå¹¶ç”Ÿæˆå“åº”</li>
</ol>
<h2 id="delayåŸç†">delayåŸç†</h2>
<p>å¯¹äºè¿è¡Œåœ¨å¼‚æ­¥IOçš„ä¹‹ä¸Šçš„WebFluxåº”ç”¨æ¥è¯´ï¼Œå…¶å·¥ä½œçº¿ç¨‹æ•°é‡å§‹ç»ˆç»´æŒåœ¨ä¸€ä¸ªå›ºå®šçš„æ•°é‡ä¸Šï¼Œç¨‹åºé€»è¾‘ä¸­æœ‰é˜»å¡ï¼ˆå¦‚ioé˜»å¡ç­‰ï¼‰éœ€è¦è¿›è¡Œå¼‚æ­¥åŒ–ã€‚å¦‚æ–°å‡ºçš„WebClientå·¥å…·å°±æ˜¯å°†httpè¯·æ±‚ioå¼‚æ­¥åŒ–ï¼Œç”¨delayæ–¹æ³•ä»£æ›¿sleepæ–¹æ³•å°†å»¶æ—¶å¼‚æ­¥åŒ–ã€‚</p>
<h3 id="delayåŸç†å®ç°">delayåŸç†å®ç°</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Mono<span style="color:#f92672">&lt;</span>Long<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">delay</span><span style="color:#f92672">(</span>Duration duration<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">return</span> delay<span style="color:#f92672">(</span>duration<span style="color:#f92672">,</span> Schedulers<span style="color:#f92672">.</span><span style="color:#a6e22e">parallel</span><span style="color:#f92672">());</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Mono<span style="color:#f92672">&lt;</span>Long<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">delay</span><span style="color:#f92672">(</span>Duration duration<span style="color:#f92672">,</span> Scheduler timer<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">return</span> onAssembly<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> MonoDelay<span style="color:#f92672">(</span>duration<span style="color:#f92672">.</span><span style="color:#a6e22e">toMillis</span><span style="color:#f92672">(),</span> TimeUnit<span style="color:#f92672">.</span><span style="color:#a6e22e">MILLISECONDS</span><span style="color:#f92672">,</span> timer<span style="color:#f92672">));</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>æŸ¥çœ‹delayæ–¹æ³•æºç ï¼Œå¯ä»¥çœ‹åˆ°å®ƒé‡Œé¢å…¶å®æ„é€ ä¸€ä¸ªMonoDelayç±»ï¼Œå¹¶é€šè¿‡ä¼ å…¥å…¨å±€å…¬ç”¨çš„è°ƒåº¦å™¨Schedulers.parallel()æ¥è°ƒåº¦é‡Œé¢çš„å¼‚æ­¥ä»»åŠ¡ã€‚</p>
<p>æŸ¥çœ‹MonoDelayç±»çš„subscribeæ–¹æ³•</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">subscribe</span><span style="color:#f92672">(</span>CoreSubscriber<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">super</span> Long<span style="color:#f92672">&gt;</span> actual<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
	MonoDelayRunnable r <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MonoDelayRunnable<span style="color:#f92672">(</span>actual<span style="color:#f92672">);</span>

	actual<span style="color:#f92672">.</span><span style="color:#a6e22e">onSubscribe</span><span style="color:#f92672">(</span>r<span style="color:#f92672">);</span>

	<span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
		r<span style="color:#f92672">.</span><span style="color:#a6e22e">setCancel</span><span style="color:#f92672">(</span>timedScheduler<span style="color:#f92672">.</span><span style="color:#a6e22e">schedule</span><span style="color:#f92672">(</span>r<span style="color:#f92672">,</span> delay<span style="color:#f92672">,</span> unit<span style="color:#f92672">));</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>RejectedExecutionException ree<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>r<span style="color:#f92672">.</span><span style="color:#a6e22e">cancel</span> <span style="color:#f92672">!=</span> OperatorDisposables<span style="color:#f92672">.</span><span style="color:#a6e22e">DISPOSED</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			actual<span style="color:#f92672">.</span><span style="color:#a6e22e">onError</span><span style="color:#f92672">(</span>Operators<span style="color:#f92672">.</span><span style="color:#a6e22e">onRejectedExecution</span><span style="color:#f92672">(</span>ree<span style="color:#f92672">,</span> r<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span>
					actual<span style="color:#f92672">.</span><span style="color:#a6e22e">currentContext</span><span style="color:#f92672">()));</span>
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>ä»£ç timedScheduler.schedule(r, delay, unit)æ–¹æ³•ï¼Œé€šè¿‡timedScheduleræ¥è°ƒåº¦å»¶æ—¶ä»»åŠ¡ã€‚</p>
<p>æŸ¥çœ‹timedSchedulerçš„scheduleæ–¹æ³•</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> Disposable <span style="color:#a6e22e">schedule</span><span style="color:#f92672">(</span>Runnable task<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> delay<span style="color:#f92672">,</span> TimeUnit unit<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
	    <span style="color:#66d9ef">return</span> Schedulers<span style="color:#f92672">.</span><span style="color:#a6e22e">directSchedule</span><span style="color:#f92672">(</span>pick<span style="color:#f92672">(),</span> task<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> delay<span style="color:#f92672">,</span> unit<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

<span style="color:#66d9ef">static</span> Disposable <span style="color:#a6e22e">directSchedule</span><span style="color:#f92672">(</span>ScheduledExecutorService exec<span style="color:#f92672">,</span>
			Runnable task<span style="color:#f92672">,</span>
			<span style="color:#a6e22e">@Nullable</span> Disposable parent<span style="color:#f92672">,</span>
			<span style="color:#66d9ef">long</span> delay<span style="color:#f92672">,</span>
			TimeUnit unit<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		task <span style="color:#f92672">=</span> onSchedule<span style="color:#f92672">(</span>task<span style="color:#f92672">);</span>
		SchedulerTask sr <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SchedulerTask<span style="color:#f92672">(</span>task<span style="color:#f92672">,</span> parent<span style="color:#f92672">);</span>
		Future<span style="color:#f92672">&lt;?&gt;</span> f<span style="color:#f92672">;</span>
		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>delay <span style="color:#f92672">&lt;=</span> 0L<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			f <span style="color:#f92672">=</span> exec<span style="color:#f92672">.</span><span style="color:#a6e22e">submit</span><span style="color:#f92672">((</span>Callable<span style="color:#f92672">&lt;?&gt;)</span> sr<span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
			f <span style="color:#f92672">=</span> exec<span style="color:#f92672">.</span><span style="color:#a6e22e">schedule</span><span style="color:#f92672">((</span>Callable<span style="color:#f92672">&lt;?&gt;)</span> sr<span style="color:#f92672">,</span> delay<span style="color:#f92672">,</span> unit<span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
		sr<span style="color:#f92672">.</span><span style="color:#a6e22e">setFuture</span><span style="color:#f92672">(</span>f<span style="color:#f92672">);</span>

		<span style="color:#66d9ef">return</span> sr<span style="color:#f92672">;</span>
	<span style="color:#f92672">}</span>
</code></pre></div><p>é€šè¿‡directScheduleå¯ä»¥çœ‹å‡ºï¼Œdelayæ–¹æ³•ä¹‹æ‰€ä»¥æ²¡æœ‰é˜»å¡ä¸»çº¿ç¨‹ï¼Œå› ä¸ºå®ƒçš„å»¶æ—¶å¤„ç†çš„é€»è¾‘åŒ…è£…æˆSchedulerTaskï¼Œäº¤ç»™äº†ScheduledExecutorServiceæ‰§è¡Œå™¨å¤„ç†ï¼Œè°ƒç”¨delayæ–¹æ³•çš„ä¸»çº¿ç¨‹å°±ç›´æ¥è¿”å›äº†ï¼Œå½“delay&gt;0æ˜¯ä½¿ç”¨ScheduledExecutorServiceè¿›è¡Œå»¶è¿Ÿè°ƒåº¦ã€‚</p>
<h3 id="ç»“è®º">ç»“è®º</h3>
<p>WebFluxå°†éƒ¨åˆ†é˜»å¡çš„é€»è¾‘ä¿®æ”¹ä¸ºç±»ä¼¼äºdelayæ–¹æ³•çš„å®ç°ï¼Œåˆ©ç”¨è°ƒåº¦æ‰§è¡Œå™¨å»å¼‚æ­¥æ‰§è¡Œé˜»å¡çš„é€»è¾‘ï¼Œä¸é˜»å¡EventLoopçº¿ç¨‹ï¼Œä½¿å¾—å°‘é‡çš„å·¥ä½œçº¿ç¨‹å¯ä»¥æ‰¿è½½æ›´å¤šçš„è¯·æ±‚ã€‚</p>
<h2 id="é€‚ç”¨åœºæ™¯">é€‚ç”¨åœºæ™¯</h2>
<p>ä½¿ç”¨ Spring WebFluxï¼Œä¸‹æ¸¸ä½¿ç”¨çš„å®‰å…¨è®¤è¯å±‚ã€æ•°æ®è®¿é—®å±‚æ¡†æ¶éƒ½å¿…é¡»ä½¿ç”¨ Reactive API ä¿è¯ä¸Šä¸‹æ¸¸éƒ½æ˜¯åŒ¹é…çš„ï¼Œéé˜»å¡çš„ã€‚ç„¶è€ŒSpring Data Reactive Repositories ç›®å‰åªæ”¯æŒ MongoDBã€Redis å’ŒCouchbase ç­‰å‡ ç§ä¸æ”¯æŒäº‹åŠ¡ç®¡ç†çš„ NOSQLï¼ŒæŠ€æœ¯é€‰å‹æ—¶éœ€è¦æƒè¡¡åˆ©å¼Šå’Œé£é™©ã€‚</p>
<ol>
<li>Spring MVCèƒ½æ»¡è¶³åœºæ™¯çš„ï¼Œå°±ä¸éœ€è¦æ›´æ”¹ä¸º Spring WebFluxï¼Œæ¯•ç«ŸReactiveå†™æ³•å¯¹æ¯”åŸæœ¬åŒæ­¥æ‰§è¡Œçš„ç¨‹åºå†™æ³•å¾ˆä¸åŒï¼Œè€Œä¸”å¾ˆå¤šåŸºäºServletçº¿ç¨‹æ¨¡å‹çš„åº“å°†æ— æ³•ä½¿ç”¨ï¼Œå¦‚Spring Transaction&hellip;&hellip;ã€‚</li>
<li>éœ€è¦åº•å±‚å®¹å™¨çš„æ”¯æŒï¼ˆNettyå’ŒServlet3.1+ï¼‰ã€‚</li>
<li>é€‚åˆåº”ç”¨åœ¨ IO å¯†é›†å‹çš„æœåŠ¡ä¸­ï¼ˆIO å¯†é›†å‹åŒ…æ‹¬ï¼šç£ç›˜IOå¯†é›†å‹, ç½‘ç»œIOå¯†é›†å‹ï¼‰ï¼Œå¾®æœåŠ¡ç½‘å…³å°±å±äºç½‘ç»œ IO å¯†é›†å‹ï¼Œä½¿ç”¨å¼‚æ­¥éé˜»å¡å¼ç¼–ç¨‹æ¨¡å‹ï¼Œèƒ½å¤Ÿæ˜¾è‘—åœ°æå‡ç½‘å…³å¯¹ä¸‹æ¸¸æœåŠ¡è½¬å‘çš„ååé‡ã€‚</li>
</ol>
        </p>
    </div>
</div>

<aside class="post-toc">
    <nav id="toc">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#å…³äºwebflux">å…³äºWebFlux</a></li>
        <li><a href="#webfluxå¯¹æ¯”springmvcå¹¶å‘æ¨¡å‹">WebFluxå¯¹æ¯”SpringMVCå¹¶å‘æ¨¡å‹</a>
          <ul>
            <li>
              <ul>
                <li><a href="#springmvcåŸºäºçš„servletå¹¶å‘æ¨¡å‹">SpringMVCåŸºäºçš„Servletå¹¶å‘æ¨¡å‹</a></li>
                <li><a href="#webfluxå¹¶å‘æ¨¡å‹">WebFluxå¹¶å‘æ¨¡å‹</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#èŒƒä¾‹">èŒƒä¾‹</a></li>
        <li><a href="#æ€§èƒ½">æ€§èƒ½</a>
          <ul>
            <li><a href="#webfluxå¯¹æ¯”springmvcçš„æ€§èƒ½æµ‹è¯•">webfluxå¯¹æ¯”SpringMVCçš„æ€§èƒ½æµ‹è¯•</a></li>
          </ul>
        </li>
        <li><a href="#webfluxè¯·æ±‚åˆ†å‘">WebFluxè¯·æ±‚åˆ†å‘</a>
          <ul>
            <li><a href="#reactorçš„mapflatmapconcatmap">reactorçš„mapï¼ŒflatMapï¼ŒconcatMap</a></li>
            <li><a href="#webflux-çš„dispatcherhandler">WebFlux çš„DispatcherHandler</a></li>
          </ul>
        </li>
        <li><a href="#delayåŸç†">delayåŸç†</a>
          <ul>
            <li><a href="#delayåŸç†å®ç°">delayåŸç†å®ç°</a></li>
            <li><a href="#ç»“è®º">ç»“è®º</a></li>
          </ul>
        </li>
        <li><a href="#é€‚ç”¨åœºæ™¯">é€‚ç”¨åœºæ™¯</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </nav>
</aside>



    

        </main><footer class="footer">
    <span>&copy; 2022 hanrong.li</span>
    <span>
        Made with &#10084;&#65039; using <a target="_blank" href="https://github.com/526avijitgupta/gokarna">Gokarna</a>
    </span>
</footer>
</body>
</html>
